<!doctype html>
<!--
  MOCKUP GENERATOR

  A client-side tool to place logos on products with perspective.
  Works completely offline.
-->
<html lang="en" class="dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Gerador de Mockups de Produto</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- PDF.js for PDF support -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
        <script>
            if (typeof pdfjsLib !== "undefined") {
                pdfjsLib.GlobalWorkerOptions.workerSrc =
                    "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
            }
        </script>
        <script>
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            orange: {
                                50: "#fff7ed",
                                100: "#ffedd5",
                                200: "#fed7aa",
                                300: "#fdba74",
                                400: "#fb923c",
                                500: "#FF7518",
                                600: "#ea580c",
                                700: "#c2410c",
                                800: "#9a3412",
                                900: "#7c2d12",
                            },
                        },
                    },
                },
            };
        </script>
        <style>
            input[type="range"] {
                -webkit-appearance: none;
                appearance: none;
                width: 100%;
                background: transparent;
            }

            input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                height: 16px;
                width: 16px;
                border-radius: 50%;
                background: #ff7518;
                cursor: pointer;
                margin-top: -6px;
                animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }

            .dark input[type="range"]::-webkit-slider-thumb {
                box-shadow: 0 0 0 2px #1a1a1a;
            }

            input[type="range"]::-webkit-slider-thumb {
                box-shadow: 0 0 0 2px #ffffff;
            }

            input[type="range"]::-webkit-slider-runnable-track {
                width: 100%;
                height: 4px;
                cursor: pointer;
                border-radius: 2px;
            }

            .dark input[type="range"]::-webkit-slider-runnable-track {
                background: #2a2a2a;
            }

            input[type="range"]::-webkit-slider-runnable-track {
                background: #e5e5e5;
            }

            input[type="range"]:focus {
                outline: none;
            }

            input[type="file"]::file-selector-button {
                border: 1px solid;
                padding: 0.5rem 1rem;
                border-radius: 0.375rem;
                cursor: pointer;
                transition: all 0.2s;
                margin-right: 1rem;
                font-family: monospace;
                font-size: 0.75rem;
                font-weight: 500;
            }

            .dark input[type="file"]::file-selector-button {
                background-color: #2a2a2a;
                color: #e5e5e5;
                border-color: #404040;
            }

            .dark input[type="file"]::file-selector-button:hover {
                background-color: #404040;
                border-color: #525252;
            }

            input[type="file"]::file-selector-button {
                background-color: #f5f5f5;
                color: #171717;
                border-color: #d4d4d4;
            }

            input[type="file"]::file-selector-button:hover {
                background-color: #e5e5e5;
                border-color: #a3a3a3;
            }

            /* Custom scrollbar styles */
            main::-webkit-scrollbar,
            #bgRemovalModal .overflow-y-auto::-webkit-scrollbar,
            #helpModal .overflow-y-auto::-webkit-scrollbar {
                width: 12px;
            }

            main::-webkit-scrollbar-track,
            #bgRemovalModal .overflow-y-auto::-webkit-scrollbar-track,
            #helpModal .overflow-y-auto::-webkit-scrollbar-track {
                background: #262626;
            }

            main::-webkit-scrollbar-thumb,
            #bgRemovalModal .overflow-y-auto::-webkit-scrollbar-thumb,
            #helpModal .overflow-y-auto::-webkit-scrollbar-thumb {
                background: #f97316;
                border-radius: 6px;
            }

            main::-webkit-scrollbar-thumb:hover,
            #bgRemovalModal .overflow-y-auto::-webkit-scrollbar-thumb:hover,
            #helpModal .overflow-y-auto::-webkit-scrollbar-thumb:hover {
                background: #ea580c;
            }
        </style>
    </head>

    <body
        class="bg-white dark:bg-neutral-950 text-neutral-900 dark:text-neutral-100 font-sans h-screen flex flex-col overflow-hidden transition-colors"
    >
        <!-- Login Overlay -->
        <div
            id="loginOverlay"
            class="fixed inset-0 z-[200] bg-neutral-950 flex flex-col items-center justify-center p-4 transition-opacity duration-500"
        >
            <div class="w-full max-w-md space-y-8 text-center">
                <img
                    src="LOGOS/imacx_neg.svg"
                    alt="IMACX"
                    class="h-16 mx-auto mb-8"
                />
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-white tracking-tight">
                        Acesso Restrito
                    </h2>
                    <p class="text-neutral-400 text-sm">
                        Esta ferramenta √© para uso exclusivo de utilizadores
                        autorizados.
                    </p>
                </div>
                <form id="loginForm" class="mt-8 space-y-6">
                    <div class="space-y-2">
                        <input
                            type="password"
                            id="accessCode"
                            required
                            class="w-full px-4 py-3 bg-neutral-900 border border-neutral-800 rounded-lg text-white placeholder-neutral-600 focus:outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 transition-colors text-center font-mono tracking-widest"
                            placeholder="C√ìDIGO DE ACESSO"
                        />
                        <p
                            id="loginError"
                            class="text-red-500 text-xs font-mono hidden"
                        >
                            C√≥digo incorreto. Tente novamente.
                        </p>
                    </div>
                    <button
                        type="submit"
                        class="w-full py-3 px-4 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition-colors uppercase tracking-wider text-sm"
                    >
                        Entrar
                    </button>
                </form>
                <p class="text-neutral-600 text-xs mt-8">
                    &copy; IMACX - Mockup Generator
                </p>
            </div>
        </div>

        <script>
            // Simple Client-Side Authentication
            (function () {
                const overlay = document.getElementById("loginOverlay");
                const form = document.getElementById("loginForm");
                const input = document.getElementById("accessCode");
                const error = document.getElementById("loginError");

                // List of authorized codes (You can edit these)
                const AUTHORIZED_CODES = [
                    "IMACX2024",
                    "DESIGN",
                    "ADMIN",
                    "12345", // Example simple code
                ];

                // Check session
                if (sessionStorage.getItem("isLoggedIn") === "true") {
                    overlay.style.display = "none";
                }

                form.addEventListener("submit", (e) => {
                    e.preventDefault();
                    const code = input.value.trim();

                    if (AUTHORIZED_CODES.includes(code)) {
                        // Success
                        sessionStorage.setItem("isLoggedIn", "true");
                        overlay.style.opacity = "0";
                        setTimeout(() => {
                            overlay.style.display = "none";
                        }, 500);
                    } else {
                        // Error
                        error.classList.remove("hidden");
                        input.classList.add("border-red-500");
                        input.value = "";
                        input.focus();
                    }
                });

                input.addEventListener("input", () => {
                    error.classList.add("hidden");
                    input.classList.remove("border-red-500");
                });
            })();
        </script>

        <!-- Header -->
        <header
            class="bg-neutral-50 dark:bg-neutral-900 border-b border-neutral-200 dark:border-neutral-800 p-6 shrink-0"
        >
            <div
                class="max-w-screen-2xl mx-auto flex items-center justify-between"
            >
                <div class="flex items-center">
                    <img
                        id="mainLogo"
                        src="LOGOS/imacx_pos.svg"
                        alt="IMACX"
                        class="h-11"
                    />
                </div>
                <div class="flex items-center gap-4">
                    <button
                        id="novaBtn"
                        class="px-4 py-2 rounded-lg bg-orange-500 hover:bg-orange-600 text-white font-bold transition-colors flex items-center gap-2 text-sm uppercase tracking-wider"
                        title="Nova apresenta√ß√£o"
                    >
                        <svg
                            class="w-4 h-4"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M12 4v16m8-8H4"
                            />
                        </svg>
                        NOVA
                    </button>
                    <button
                        id="helpToggle"
                        class="p-2 rounded-lg bg-neutral-200 dark:bg-neutral-800 hover:bg-neutral-300 dark:hover:bg-neutral-700 transition-colors"
                        title="Instructions"
                    >
                        <svg
                            class="w-5 h-5"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                            />
                        </svg>
                    </button>
                    <button
                        id="themeToggle"
                        class="p-2 rounded-lg bg-neutral-200 dark:bg-neutral-800 hover:bg-neutral-300 dark:hover:bg-neutral-700 transition-colors"
                    >
                        <svg
                            id="sunIcon"
                            class="w-5 h-5 hidden dark:block"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                            />
                        </svg>
                        <svg
                            id="moonIcon"
                            class="w-5 h-5 block dark:hidden"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                            />
                        </svg>
                    </button>
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-green-500"></span>
                        <span
                            class="text-xs font-mono text-neutral-500 dark:text-neutral-500"
                            >SISTEMA PRONTO</span
                        >
                    </div>
                </div>
            </div>
        </header>

        <!-- Help Modal -->
        <div
            id="helpModal"
            class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-8"
        >
            <div
                class="bg-white dark:bg-neutral-900 rounded-lg shadow-2xl max-w-3xl w-full max-h-[80vh] overflow-y-auto"
            >
                <div
                    class="sticky top-0 bg-white dark:bg-neutral-900 border-b border-neutral-200 dark:border-neutral-800 p-6 flex items-center justify-between"
                >
                    <h2 class="text-xl font-bold flex items-center gap-3">
                        <span class="w-3 h-6 bg-orange-500 rounded-sm"></span>
                        Guia R√°pido
                    </h2>
                    <button
                        id="closeHelp"
                        class="p-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-lg transition-colors"
                    >
                        <svg
                            class="w-6 h-6"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"
                            />
                        </svg>
                    </button>
                </div>
                <div class="p-6 space-y-6 text-sm">
                    <section>
                        <h3 class="text-lg font-bold mb-3 text-orange-500">
                            Como Funciona
                        </h3>
                        <p class="text-neutral-600 dark:text-neutral-400">
                            Esta ferramenta aplica o seu log√≥tipo em produtos
                            com perspectiva perfeita usando matem√°tica (sem IA).
                        </p>
                    </section>

                    <section>
                        <h3 class="text-lg font-bold mb-3 text-orange-500">
                            Passos B√°sicos
                        </h3>
                        <ol
                            class="space-y-2 text-neutral-600 dark:text-neutral-400 list-decimal list-inside"
                        >
                            <li>
                                <strong>Preencha os detalhes do produto</strong>
                                - T√≠tulo, descri√ß√£o, dimens√£o de impress√£o e
                                n√∫mero de cores
                            </li>
                            <li>
                                <strong>Carregue as imagens</strong> - Imagem do
                                produto e log√≥tipo (PNG com fundo transparente
                                recomendado)
                            </li>
                            <li>
                                <strong>Ajuste o log√≥tipo</strong> - Arraste
                                para reposicionar, ajuste o tamanho e a rota√ß√£o
                            </li>
                            <li>
                                <strong>Escolha o modo de renderiza√ß√£o</strong>
                                - Sobreposi√ß√£o 2D para produtos planos,
                                Perspectiva para produtos 3D
                            </li>
                            <li>
                                <strong>Gere a apresenta√ß√£o</strong> - Use o
                                bot√£o "Apresenta√ß√£o Desktop" para visualizar e
                                exportar
                            </li>
                        </ol>
                    </section>

                    <section>
                        <h3 class="text-lg font-bold mb-3 text-orange-500">
                            Modos de Renderiza√ß√£o
                        </h3>
                        <div class="space-y-3">
                            <div
                                class="p-4 bg-neutral-50 dark:bg-neutral-950 rounded-lg"
                            >
                                <h4 class="font-bold mb-2">
                                    Sobreposi√ß√£o 2D (Recomendado)
                                </h4>
                                <p
                                    class="text-neutral-600 dark:text-neutral-400 text-xs"
                                >
                                    Perfeito para produtos planos como cart√µes,
                                    autocolantes e caixas. Renderiza√ß√£o
                                    instant√¢nea com controlos de arrastar.
                                </p>
                            </div>
                            <div
                                class="p-4 bg-neutral-50 dark:bg-neutral-950 rounded-lg"
                            >
                                <h4 class="font-bold mb-2">Modo Perspectiva</h4>
                                <p
                                    class="text-neutral-600 dark:text-neutral-400 text-xs"
                                >
                                    Para produtos 3D com superf√≠cies curvas ou
                                    angulares. Arraste os cantos para ajustar a
                                    perspectiva. Clique dentro para mover todo o
                                    log√≥tipo.
                                </p>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-lg font-bold mb-3 text-orange-500">
                            Dicas
                        </h3>
                        <ul
                            class="space-y-2 text-neutral-600 dark:text-neutral-400 text-xs"
                        >
                            <li class="flex items-start gap-2">
                                <span class="text-green-500 mt-1">‚úì</span>
                                <span
                                    >Use log√≥tipos PNG com fundo transparente
                                    para melhores resultados</span
                                >
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-green-500 mt-1">‚úì</span>
                                <span
                                    >Se o log√≥tipo tiver fundo, use a ferramenta
                                    "Remover Fundo" para torn√°-lo transparente
                                    ou branco</span
                                >
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-green-500 mt-1">‚úì</span>
                                <span
                                    >Para produtos planos, use o modo
                                    Sobreposi√ß√£o 2D</span
                                >
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-green-500 mt-1">‚úì</span>
                                <span
                                    >Para produtos 3D, use o modo Perspectiva e
                                    ajuste os cantos</span
                                >
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-green-500 mt-1">‚úì</span>
                                <span
                                    >Todas as altera√ß√µes atualizam em tempo real
                                    no canvas</span
                                >
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-green-500 mt-1">‚úì</span>
                                <span
                                    >Funciona completamente offline - sem
                                    necessidade de internet</span
                                >
                            </li>
                        </ul>
                    </section>

                    <section>
                        <h3 class="text-lg font-bold mb-3 text-orange-500">
                            Resolu√ß√£o de Problemas
                        </h3>
                        <div class="space-y-2 text-xs">
                            <div>
                                <strong
                                    class="text-neutral-900 dark:text-neutral-100"
                                    >Log√≥tipo n√£o vis√≠vel?</strong
                                >
                                <p
                                    class="text-neutral-600 dark:text-neutral-400"
                                >
                                    ‚Üí Certifique-se de que ambas as imagens
                                    est√£o carregadas
                                </p>
                            </div>
                            <div>
                                <strong
                                    class="text-neutral-900 dark:text-neutral-100"
                                    >N√£o consegue reposicionar?</strong
                                >
                                <p
                                    class="text-neutral-600 dark:text-neutral-400"
                                >
                                    ‚Üí Certifique-se de que carregou ambas as
                                    imagens primeiro
                                </p>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <!-- Background Removal Modal -->
        <div
            id="bgRemovalModal"
            class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-8"
        >
            <div
                class="bg-white dark:bg-neutral-900 rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col"
            >
                <div
                    class="bg-white dark:bg-neutral-900 border-b border-neutral-200 dark:border-neutral-800 p-6 flex items-center justify-between"
                >
                    <h2 class="text-xl font-bold flex items-center gap-3">
                        <span class="w-3 h-6 bg-orange-500 rounded-sm"></span>
                        Remover Fundo do Log√≥tipo
                    </h2>
                    <button
                        id="closeBgRemoval"
                        class="p-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-lg transition-colors"
                    >
                        <svg
                            class="w-6 h-6"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"
                            />
                        </svg>
                    </button>
                </div>
                <div
                    class="p-6 flex-1 overflow-y-auto"
                    style="
                        scrollbar-width: thin;
                        scrollbar-color: #ff7518 #262626;
                    "
                >
                    <div class="grid grid-cols-2 gap-6 h-full">
                        <!-- Left: Original -->
                        <div class="space-y-3">
                            <h3
                                class="text-sm font-mono uppercase tracking-wider text-neutral-500"
                            >
                                Original
                            </h3>
                            <div
                                class="bg-neutral-100 dark:bg-neutral-950 rounded-lg border-2 border-neutral-200 dark:border-neutral-800 aspect-square flex items-center justify-center overflow-hidden"
                                style="
                                    background-image: repeating-conic-gradient(
                                            #e5e5e5 0% 25%,
                                            transparent 0% 50%
                                        )
                                        50% / 20px 20px;
                                "
                            >
                                <canvas
                                    id="bgRemovalOriginal"
                                    class="max-w-full max-h-full"
                                ></canvas>
                            </div>
                        </div>
                        <!-- Right: Preview -->
                        <div class="space-y-3">
                            <h3
                                id="previewModeTitle"
                                class="text-sm font-mono uppercase tracking-wider text-neutral-500"
                            >
                                Preview
                            </h3>
                            <div
                                id="previewContainer"
                                class="bg-neutral-100 dark:bg-neutral-950 rounded-lg border-2 border-dashed border-orange-500 aspect-square flex items-center justify-center overflow-hidden"
                                style="
                                    background-image: repeating-conic-gradient(
                                            #e5e5e5 0% 25%,
                                            transparent 0% 50%
                                        )
                                        50% / 20px 20px;
                                "
                            >
                                <canvas
                                    id="bgRemovalPreview"
                                    class="max-w-full max-h-full"
                                ></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- MODE TOGGLE -->
                    <div class="mt-6 space-y-3">
                        <label
                            class="text-xs font-mono uppercase tracking-wider text-neutral-500"
                        >
                            A√ß√£o na Cor Selecionada
                        </label>
                        <div class="grid grid-cols-3 gap-3">
                            <label
                                class="flex items-center gap-2 cursor-pointer px-4 py-2 bg-neutral-100 dark:bg-neutral-950 rounded-lg border-2 border-neutral-300 dark:border-neutral-700 has-[:checked]:border-orange-500 has-[:checked]:bg-orange-500/10 transition-all"
                            >
                                <input
                                    type="radio"
                                    name="bgMode"
                                    value="transparent"
                                    checked
                                    class="w-4 h-4 text-orange-500 accent-orange-500"
                                />
                                <span class="text-sm font-mono"
                                    >üî≤ TORNAR TRANSPARENTE</span
                                >
                            </label>
                            <label
                                class="flex items-center gap-2 cursor-pointer px-4 py-2 bg-neutral-100 dark:bg-neutral-950 rounded-lg border-2 border-neutral-300 dark:border-neutral-700 has-[:checked]:border-orange-500 has-[:checked]:bg-orange-500/10 transition-all"
                            >
                                <input
                                    type="radio"
                                    name="bgMode"
                                    value="white"
                                    class="w-4 h-4 text-orange-500 accent-orange-500"
                                />
                                <span class="text-sm font-mono"
                                    >‚¨ú MUDAR COR PARA BRANCO</span
                                >
                            </label>
                            <label
                                class="flex items-center gap-2 cursor-pointer px-4 py-2 bg-neutral-100 dark:bg-neutral-950 rounded-lg border-2 border-neutral-300 dark:border-neutral-700 has-[:checked]:border-orange-500 has-[:checked]:bg-orange-500/10 transition-all"
                            >
                                <input
                                    type="radio"
                                    name="bgMode"
                                    value="blackwhite"
                                    class="w-4 h-4 text-orange-500 accent-orange-500"
                                />
                                <span class="text-sm font-mono"
                                    >‚¨õ‚¨ú PRETO & BRANCO</span
                                >
                            </label>
                        </div>
                    </div>

                    <div class="mt-6 space-y-4">
                        <div class="flex items-center gap-4">
                            <div class="flex-1 space-y-2">
                                <label
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500"
                                >
                                    Clique na imagem para selecionar a cor de
                                    fundo
                                </label>
                                <div class="flex items-center gap-3">
                                    <div
                                        id="selectedColor"
                                        class="w-12 h-12 rounded-lg border-2 border-neutral-300 dark:border-neutral-700"
                                        style="background: #ffffff"
                                    ></div>
                                    <div class="flex-1">
                                        <label
                                            class="text-xs font-mono text-neutral-500 mb-1 block"
                                            >Toler√¢ncia</label
                                        >
                                        <input
                                            type="range"
                                            id="toleranceRange"
                                            min="0"
                                            max="100"
                                            value="30"
                                            class="w-full"
                                        />
                                        <div
                                            class="flex justify-between text-xs text-neutral-500 mt-1"
                                        >
                                            <span>Preciso</span>
                                            <span
                                                id="toleranceValue"
                                                class="font-bold text-orange-500"
                                                >30</span
                                            >
                                            <span>Amplo</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div
                    class="p-6 border-t border-neutral-200 dark:border-neutral-800 flex gap-3"
                >
                    <button
                        id="undoBgRemoval"
                        disabled
                        class="py-3 px-6 bg-neutral-200 dark:bg-neutral-800 hover:bg-neutral-300 dark:hover:bg-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed text-neutral-900 dark:text-white font-bold rounded-lg transition-colors flex items-center gap-2"
                    >
                        <svg
                            class="w-4 h-4"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"
                            />
                        </svg>
                        REVERTER
                    </button>
                    <button
                        id="cancelBgRemoval"
                        class="flex-1 py-3 px-6 bg-neutral-200 dark:bg-neutral-800 hover:bg-neutral-300 dark:hover:bg-neutral-700 text-neutral-900 dark:text-white font-bold rounded-lg transition-colors"
                    >
                        CANCELAR
                    </button>
                    <button
                        id="applyBgRemoval"
                        class="flex-1 py-3 px-6 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition-colors"
                    >
                        APLICAR & USAR
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main
            class="flex-1 p-8 overflow-y-scroll overflow-x-hidden"
            style="scrollbar-width: thin; scrollbar-color: #ff7518 #262626"
        >
            <div class="max-w-screen-2xl mx-auto flex flex-col gap-8">
                <!-- Top: Product Details Card -->
                <div
                    class="bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-8 shadow-xl"
                >
                    <div class="space-y-6">
                        <!-- Cliente and Ref on same line -->
                        <div class="grid grid-cols-2 gap-6">
                            <div class="space-y-3">
                                <label
                                    for="clientName"
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                                >
                                    <span
                                        class="w-2 h-2 bg-orange-500 rounded-full"
                                    ></span>
                                    01. Cliente
                                </label>
                                <input
                                    type="text"
                                    id="clientName"
                                    placeholder="Nome do cliente..."
                                    class="w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-950/30 border border-neutral-200 dark:border-neutral-800 rounded-md text-sm text-neutral-900 dark:text-neutral-100 placeholder-neutral-500 dark:placeholder-neutral-600 focus:outline-none focus:border-orange-500 transition-colors font-mono"
                                />
                            </div>
                            <div class="space-y-3">
                                <label
                                    for="refNumber"
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                                >
                                    <span
                                        class="w-2 h-2 bg-orange-500 rounded-full"
                                    ></span>
                                    02. Ref
                                </label>
                                <input
                                    type="text"
                                    id="refNumber"
                                    placeholder="Refer√™ncia..."
                                    class="w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-950/30 border border-neutral-200 dark:border-neutral-800 rounded-md text-sm text-neutral-900 dark:text-neutral-100 placeholder-neutral-500 dark:placeholder-neutral-600 focus:outline-none focus:border-orange-500 transition-colors font-mono"
                                />
                            </div>
                        </div>

                        <!-- Title -->
                        <div class="space-y-3">
                            <label
                                for="productTitle"
                                class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                            >
                                <span
                                    class="w-2 h-2 bg-orange-500 rounded-full"
                                ></span>
                                03. T√≠tulo do Produto
                            </label>
                            <input
                                type="text"
                                id="productTitle"
                                placeholder="Insira o t√≠tulo do produto..."
                                class="w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-950/30 border border-neutral-200 dark:border-neutral-800 rounded-md text-sm text-neutral-900 dark:text-neutral-100 placeholder-neutral-500 dark:placeholder-neutral-600 focus:outline-none focus:border-orange-500 transition-colors font-mono"
                            />
                        </div>

                        <!-- Description, Quantity and Date -->
                        <div
                            class="grid gap-6"
                            style="grid-template-columns: 1fr auto auto"
                        >
                            <div class="space-y-3">
                                <label
                                    for="productDescription"
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                                >
                                    <span
                                        class="w-2 h-2 bg-orange-500 rounded-full"
                                    ></span>
                                    04. Descri√ß√£o
                                </label>
                                <textarea
                                    id="productDescription"
                                    placeholder="Insira a descri√ß√£o do produto..."
                                    rows="4"
                                    class="w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-950/30 border border-neutral-200 dark:border-neutral-800 rounded-md text-sm text-neutral-900 dark:text-neutral-100 placeholder-neutral-500 dark:placeholder-neutral-600 focus:outline-none focus:border-orange-500 transition-colors font-mono resize-none"
                                ></textarea>
                            </div>
                            <div class="space-y-3">
                                <label
                                    for="quantity"
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                                >
                                    <span
                                        class="w-2 h-2 bg-orange-500 rounded-full"
                                    ></span>
                                    05. Qtd
                                </label>
                                <input
                                    type="text"
                                    id="quantity"
                                    placeholder="50, 100, 200..."
                                    class="w-32 px-4 py-3 bg-neutral-100 dark:bg-neutral-950/30 border border-neutral-200 dark:border-neutral-800 rounded-md text-sm text-neutral-900 dark:text-neutral-100 placeholder-neutral-500 dark:placeholder-neutral-600 focus:outline-none focus:border-orange-500 transition-colors font-mono"
                                />
                            </div>
                            <div class="space-y-3">
                                <label
                                    for="deliveryDate"
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                                >
                                    <span
                                        class="w-2 h-2 bg-orange-500 rounded-full"
                                    ></span>
                                    06. Data
                                </label>
                                <input
                                    type="date"
                                    id="deliveryDate"
                                    class="w-40 px-4 py-3 bg-neutral-100 dark:bg-neutral-950/30 border border-neutral-200 dark:border-neutral-800 rounded-md text-sm text-neutral-900 dark:text-neutral-100 placeholder-neutral-500 dark:placeholder-neutral-600 focus:outline-none focus:border-orange-500 transition-colors font-mono"
                                />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bottom Row: Canvas and Controls -->
                <div class="flex flex-col lg:flex-row gap-8 items-stretch">
                    <!-- Left: Canvas Area -->
                    <div class="shrink-0">
                        <div
                            class="bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-6 shadow-xl"
                        >
                            <div
                                class="bg-neutral-100 dark:bg-neutral-950 rounded-md border border-neutral-200 dark:border-neutral-800 relative overflow-hidden flex items-center justify-center"
                                style="width: 600px; height: 600px"
                            >
                                <canvas
                                    id="mockupCanvas"
                                    width="600"
                                    height="600"
                                    class="block w-full h-full cursor-move"
                                ></canvas>

                                <!-- Empty State Overlay -->
                                <div
                                    id="emptyState"
                                    class="absolute inset-0 flex flex-col items-center justify-center bg-neutral-100/90 dark:bg-neutral-950/90 backdrop-blur-sm text-center p-6 pointer-events-none"
                                >
                                    <div
                                        class="w-20 h-20 border-2 border-dashed border-neutral-300 dark:border-neutral-700 rounded-full flex items-center justify-center mb-6 text-neutral-400 dark:text-neutral-600"
                                    >
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="40"
                                            height="40"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="1.5"
                                        >
                                            <rect
                                                x="3"
                                                y="3"
                                                width="18"
                                                height="18"
                                                rx="2"
                                                ry="2"
                                            />
                                            <circle cx="8.5" cy="8.5" r="1.5" />
                                            <polyline
                                                points="21 15 16 10 5 21"
                                            />
                                        </svg>
                                    </div>
                                    <p
                                        class="text-base font-mono uppercase tracking-wider mb-2"
                                    >
                                        Canvas Pronto
                                    </p>
                                    <p
                                        class="text-xs font-mono text-neutral-500 dark:text-neutral-600"
                                    >
                                        Carregue imagens do painel ‚Üí
                                    </p>
                                </div>
                            </div>
                            <div
                                class="mt-5 pt-5 border-t border-neutral-200 dark:border-neutral-800 flex items-center justify-center gap-3 text-xs font-mono text-neutral-500 dark:text-neutral-600"
                            >
                                <svg
                                    width="14"
                                    height="14"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path d="M3.5 12h17" />
                                    <path d="M12 3.5v17" />
                                </svg>
                                <span
                                    >ARRASTE O LOG√ìTIPO PARA REPOSICIONAR</span
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Right: Mockup Controls Card -->
                    <div
                        class="bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-lg p-8 shadow-xl flex-1 flex flex-col"
                    >
                        <!-- TABS -->
                        <!-- TABS -->
                        <div
                            class="flex border-b border-neutral-200 dark:border-neutral-800 mb-6 bg-neutral-100 dark:bg-neutral-950 rounded-t-lg overflow-hidden p-1 gap-1"
                        >
                            <button
                                id="tabPos1"
                                class="flex-1 py-2 text-sm font-mono font-bold text-orange-500 bg-white dark:bg-neutral-800 shadow-sm rounded-md transition-all"
                            >
                                POSI√á√ÉO 1
                            </button>
                            <button
                                id="tabPos2"
                                class="flex-1 py-2 text-sm font-mono font-bold text-neutral-500 dark:text-neutral-400 hover:text-neutral-700 dark:hover:text-neutral-200 hover:bg-white/50 dark:hover:bg-neutral-800/50 rounded-md transition-all"
                            >
                                POSI√á√ÉO 2
                            </button>
                        </div>

                        <!-- POS 1 CONTROLS -->
                        <div id="controlsPos1" class="space-y-8 flex-1">
                            <!-- Product and Logo Inputs - Side by Side -->
                            <div class="grid grid-cols-2 gap-6">
                                <!-- Product Input -->
                                <div class="space-y-4">
                                    <label
                                        class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2 mb-3"
                                    >
                                        <span
                                            class="w-2 h-2 bg-orange-500 rounded-full"
                                        ></span>
                                        07. Imagem do Produto
                                    </label>
                                    <input
                                        type="file"
                                        id="productInput"
                                        accept="image/*"
                                        class="block w-full text-sm text-neutral-600 dark:text-neutral-500 file:mr-4 file:py-3 file:px-6 file:rounded-md file:border-0 file:text-xs file:font-mono cursor-pointer focus:outline-none bg-neutral-100 dark:bg-neutral-950/30 p-3 rounded-md border border-neutral-200 dark:border-neutral-800 hover:border-neutral-300 dark:hover:border-neutral-700 transition-colors"
                                    />
                                </div>

                                <!-- Logo Input -->
                                <div class="space-y-4">
                                    <label
                                        class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2 mb-3"
                                    >
                                        <span
                                            class="w-2 h-2 bg-orange-500 rounded-full"
                                        ></span>
                                        08. Imagem do Log√≥tipo
                                    </label>
                                    <input
                                        type="file"
                                        id="logoInput"
                                        accept="image/*,.pdf"
                                        class="block w-full text-sm text-neutral-600 dark:text-neutral-500 file:mr-4 file:py-3 file:px-6 file:rounded-md file:border-0 file:text-xs file:font-mono cursor-pointer focus:outline-none bg-neutral-100 dark:bg-neutral-950/30 p-3 rounded-md border border-neutral-200 dark:border-neutral-800 hover:border-neutral-300 dark:hover:border-neutral-700 transition-colors"
                                    />
                                    <button
                                        id="removeBgBtn"
                                        disabled
                                        class="w-full py-2 px-4 bg-neutral-200 dark:bg-neutral-800 hover:bg-neutral-300 dark:hover:bg-neutral-700 disabled:bg-neutral-100 dark:disabled:bg-neutral-900 disabled:text-neutral-400 dark:disabled:text-neutral-600 disabled:cursor-not-allowed text-neutral-900 dark:text-white font-mono text-xs rounded-md transition-colors flex items-center justify-center gap-2"
                                    >
                                        <svg
                                            class="w-4 h-4"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                                            />
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                                            />
                                        </svg>
                                        REMOVER FUNDO
                                    </button>
                                    <p
                                        class="text-[10px] text-neutral-500 font-mono"
                                    >
                                        Suporta: PNG, JPG, PDF | AI/CDR: exporte
                                        como PDF primeiro
                                    </p>
                                </div>
                            </div>

                            <div
                                class="h-px bg-neutral-300 dark:bg-neutral-700 w-full my-8"
                            ></div>

                            <!-- Logo Size and Rotation - Side by Side -->
                            <div class="grid grid-cols-2 gap-6">
                                <!-- Scale Control -->
                                <div class="space-y-4">
                                    <div
                                        class="flex justify-between items-center mb-3"
                                    >
                                        <label
                                            for="scaleRange"
                                            class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                                        >
                                            <span
                                                class="w-2 h-2 bg-orange-500 rounded-full"
                                            ></span>
                                            09. Tamanho do Log√≥tipo
                                        </label>
                                        <span
                                            class="text-sm font-mono font-bold text-orange-600 dark:text-orange-500 bg-orange-100 dark:bg-orange-500/10 px-3 py-1.5 rounded-md"
                                            ><span id="scaleLabel">50</span
                                            >%</span
                                        >
                                    </div>
                                    <input
                                        type="range"
                                        id="scaleRange"
                                        min="10"
                                        max="200"
                                        value="50"
                                        class="w-full"
                                    />
                                </div>

                                <!-- Rotation Control -->
                                <div class="space-y-4">
                                    <div
                                        class="flex justify-between items-center mb-3"
                                    >
                                        <label
                                            for="rotationRange"
                                            class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                                        >
                                            <span
                                                class="w-2 h-2 bg-orange-500 rounded-full"
                                            ></span>
                                            10. Rota√ß√£o
                                        </label>
                                        <span
                                            class="text-sm font-mono font-bold text-orange-600 dark:text-orange-500 bg-orange-100 dark:bg-orange-500/10 px-3 py-1.5 rounded-md"
                                            ><span id="rotationLabel">0</span
                                            >¬∞</span
                                        >
                                    </div>

                                    <div class="flex items-center gap-4">
                                        <button
                                            id="rotateLeftBtn"
                                            class="shrink-0 w-10 h-10 bg-neutral-200 dark:bg-neutral-800 hover:bg-neutral-300 dark:hover:bg-neutral-700 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-100 rounded-md transition-colors border border-neutral-300 dark:border-neutral-700 flex items-center justify-center"
                                            title="-90¬∞"
                                        >
                                            <svg
                                                width="14"
                                                height="14"
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                stroke="currentColor"
                                                stroke-width="2"
                                            >
                                                <path
                                                    d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"
                                                />
                                                <path d="M3 3v5h5" />
                                            </svg>
                                        </button>

                                        <input
                                            type="range"
                                            id="rotationRange"
                                            min="-180"
                                            max="180"
                                            value="0"
                                            class="flex-1"
                                        />

                                        <button
                                            id="rotateRightBtn"
                                            class="shrink-0 w-10 h-10 bg-neutral-200 dark:bg-neutral-800 hover:bg-neutral-300 dark:hover:bg-neutral-700 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-100 rounded-md transition-colors border border-neutral-300 dark:border-neutral-700 flex items-center justify-center"
                                            title="+90¬∞"
                                        >
                                            <svg
                                                width="14"
                                                height="14"
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                stroke="currentColor"
                                                stroke-width="2"
                                            >
                                                <path
                                                    d="M21 12a9 9 0 1 1-9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"
                                                />
                                                <path d="M21 3v5h-5" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="h-px bg-neutral-300 dark:bg-neutral-700 w-full my-8"
                            ></div>

                            <!-- Print Size and Colors - Side by Side -->
                            <div class="grid grid-cols-2 gap-6">
                                <!-- Print Size -->
                                <div class="space-y-3">
                                    <label
                                        for="printSize"
                                        class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                                    >
                                        <span
                                            class="w-2 h-2 bg-orange-500 rounded-full"
                                        ></span>
                                        11. Dimens√£o de Impress√£o
                                    </label>
                                    <input
                                        type="text"
                                        id="printSize"
                                        placeholder="10x10cm"
                                        class="w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-950/30 border border-neutral-200 dark:border-neutral-800 rounded-md text-sm text-neutral-900 dark:text-neutral-100 placeholder-neutral-500 dark:placeholder-neutral-600 focus:outline-none focus:border-orange-500 transition-colors font-mono"
                                    />
                                </div>

                                <!-- Number of Colors -->
                                <div class="space-y-3">
                                    <label
                                        for="numColors"
                                        class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                                    >
                                        <span
                                            class="w-2 h-2 bg-orange-500 rounded-full"
                                        ></span>
                                        12. Cores
                                    </label>
                                    <input
                                        type="number"
                                        id="numColors"
                                        min="1"
                                        max="99"
                                        placeholder="1"
                                        class="w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-950/30 border border-neutral-200 dark:border-neutral-800 rounded-md text-sm text-neutral-900 dark:text-neutral-100 placeholder-neutral-500 dark:placeholder-neutral-600 focus:outline-none focus:border-orange-500 transition-colors font-mono"
                                    />
                                </div>
                            </div>

                            <!-- Mode Toggle -->
                            <div class="space-y-4">
                                <label
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2 mb-3"
                                >
                                    <span
                                        class="w-2 h-2 bg-orange-500 rounded-full"
                                    ></span>
                                    13. Modo de Renderiza√ß√£o
                                </label>
                                <div class="flex gap-2">
                                    <button
                                        id="mode2D"
                                        class="flex-1 py-2.5 px-4 text-xs font-mono font-bold rounded-md transition-all border-2 bg-orange-500 text-white border-orange-500"
                                    >
                                        SOBREPOSI√á√ÉO 2D
                                    </button>
                                    <button
                                        id="modePerspective"
                                        class="flex-1 py-2.5 px-4 text-xs font-mono font-bold rounded-md transition-all border-2 border-neutral-300 dark:border-neutral-700 text-neutral-600 dark:text-neutral-400 hover:border-orange-500 hover:text-orange-500"
                                    >
                                        PERSPECTIVA
                                    </button>
                                </div>
                                <!-- Perspective Controls (Instructions + Toggle) -->
                                <div
                                    id="perspectiveControls"
                                    style="display: none"
                                    class="mt-3 space-y-2"
                                >
                                    <p
                                        class="text-xs text-neutral-500 dark:text-neutral-600 font-mono"
                                    >
                                        <span id="modeDesc"
                                            >Arraste os cantos para ajustar a
                                            perspectiva manualmente</span
                                        >
                                    </p>
                                    <div id="lockPerspectiveContainer">
                                        <label
                                            class="flex items-center gap-2 cursor-pointer select-none group"
                                        >
                                            <input
                                                type="checkbox"
                                                id="lockPerspective"
                                                class="w-4 h-4 text-orange-500 rounded border-neutral-300 focus:ring-orange-500 transition-colors cursor-pointer"
                                            />
                                            <span
                                                class="text-xs font-mono text-neutral-500 dark:text-neutral-400 group-hover:text-neutral-900 dark:group-hover:text-neutral-200 transition-colors"
                                            >
                                                BLOQUEAR PERSPETIVA & USAR
                                                SLIDERS
                                            </span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Add after the mode toggle section -->
                            <div class="space-y-4">
                                <label
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2 mb-3"
                                >
                                    <span
                                        class="w-2 h-2 bg-orange-500 rounded-full"
                                    ></span>
                                    14. Efeito de Grava√ß√£o
                                </label>
                                <select
                                    id="engravingEffect"
                                    class="w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-950/30 border border-neutral-200 dark:border-neutral-800 rounded-md text-sm text-neutral-900 dark:text-neutral-100 focus:outline-none focus:border-orange-500 transition-colors font-mono cursor-pointer [&>option]:bg-white [&>option]:text-neutral-900 dark:[&>option]:bg-neutral-900 dark:[&>option]:text-neutral-100 [&>optgroup]:bg-white [&>optgroup]:text-neutral-900 dark:[&>optgroup]:bg-neutral-900 dark:[&>optgroup]:text-neutral-100"
                                >
                                    <option value="none">
                                        Sem Efeito (Normal)
                                    </option>
                                    <optgroup label="Madeira">
                                        <option value="wood-dark">
                                            Madeira - Grava√ß√£o Escura (Padr√£o)
                                        </option>
                                        <option value="wood-dark-deep">
                                            Madeira - Queimadura Profunda
                                        </option>
                                        <option value="wood-light">
                                            Madeira - Grava√ß√£o Leve
                                        </option>
                                    </optgroup>
                                    <optgroup label="Metal">
                                        <option value="metal-light">
                                            Metal - Grava√ß√£o Clara (Padr√£o)
                                        </option>
                                        <option value="metal-laser-white">
                                            Metal - Laser Branco (Intenso)
                                        </option>
                                        <option value="metal-dark">
                                            Metal - Grava√ß√£o Escura (Padr√£o)
                                        </option>
                                        <option value="metal-anneal-black">
                                            Metal - Laser Preto (Intenso)
                                        </option>
                                    </optgroup>
                                    <optgroup label="Outros">
                                        <option value="leather-emboss">
                                            Couro - Baixo Relevo
                                        </option>
                                    </optgroup>
                                </select>
                                <p
                                    id="engravingDesc"
                                    class="text-xs text-neutral-500 dark:text-neutral-600 font-mono"
                                >
                                    Selecione o tipo de grava√ß√£o a laser
                                </p>
                            </div>
                        </div>

                        <!-- POS 2 CONTROLS (Hidden) -->
                        <div id="controlsPos2" class="space-y-8 flex-1 hidden">
                            <!-- Product and Logo Inputs - Side by Side -->
                            <div class="grid grid-cols-2 gap-6">
                                <!-- Product Input -->
                                <div class="space-y-4">
                                    <label
                                        class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2 mb-3"
                                    >
                                        <span
                                            class="w-2 h-2 bg-orange-500 rounded-full"
                                        ></span>
                                        07. Imagem do Produto (Pos 2)
                                    </label>
                                    <input
                                        type="file"
                                        id="productInput_2"
                                        accept="image/*"
                                        class="block w-full text-sm text-neutral-600 dark:text-neutral-500 file:mr-4 file:py-3 file:px-6 file:rounded-md file:border-0 file:text-xs file:font-mono cursor:pointer focus:outline-none bg-neutral-100 dark:bg-neutral-950/30 p-3 rounded-md border border-neutral-200 dark:border-neutral-800 hover:border-neutral-300 dark:hover:border-neutral-700 transition-colors"
                                    />
                                </div>

                                <!-- Logo Input -->
                                <div class="space-y-4">
                                    <label
                                        class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2 mb-3"
                                    >
                                        <span
                                            class="w-2 h-2 bg-orange-500 rounded-full"
                                        ></span>
                                        08. Imagem do Log√≥tipo (Pos 2)
                                    </label>
                                    <input
                                        type="file"
                                        id="logoInput_2"
                                        accept="image/*,.pdf"
                                        class="block w-full text-sm text-neutral-600 dark:text-neutral-500 file:mr-4 file:py-3 file:px-6 file:rounded-md file:border-0 file:text-xs file:font-mono cursor:pointer focus:outline-none bg-neutral-100 dark:bg-neutral-950/30 p-3 rounded-md border border-neutral-200 dark:border-neutral-800 hover:border-neutral-300 dark:hover:border-neutral-700 transition-colors"
                                    />
                                    <button
                                        id="removeBgBtn_2"
                                        disabled
                                        class="w-full py-2 px-4 bg-neutral-200 dark:bg-neutral-800 hover:bg-neutral-300 dark:hover:bg-neutral-700 disabled:bg-neutral-100 dark:disabled:bg-neutral-900 disabled:text-neutral-400 dark:disabled:text-neutral-600 disabled:cursor-not-allowed text-neutral-900 dark:text-white font-mono text-xs rounded-md transition-colors flex items-center justify-center gap-2"
                                    >
                                        <svg
                                            class="w-4 h-4"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                                            />
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                                            />
                                        </svg>
                                        REMOVER FUNDO
                                    </button>
                                    <p
                                        class="text-[10px] text-neutral-500 font-mono"
                                    >
                                        Suporta: PNG, JPG, PDF | AI/CDR: exporte
                                        como PDF primeiro
                                    </p>
                                </div>
                            </div>

                            <div
                                class="h-px bg-neutral-300 dark:bg-neutral-700 w-full my-8"
                            ></div>

                            <!-- Logo Size and Rotation - Side by Side -->
                            <div class="grid grid-cols-2 gap-6">
                                <!-- Scale Control -->
                                <div class="space-y-4">
                                    <div
                                        class="flex justify-between items-center mb-3"
                                    >
                                        <label
                                            for="scaleRange_2"
                                            class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                                        >
                                            <span
                                                class="w-2 h-2 bg-orange-500 rounded-full"
                                            ></span>
                                            09. Tamanho do Log√≥tipo
                                        </label>
                                        <span
                                            class="text-sm font-mono font-bold text-orange-600 dark:text-orange-500 bg-orange-100 dark:bg-orange-500/10 px-3 py-1.5 rounded-md"
                                            ><span id="scaleLabel_2">50</span
                                            >%</span
                                        >
                                    </div>
                                    <input
                                        type="range"
                                        id="scaleRange_2"
                                        min="10"
                                        max="200"
                                        value="50"
                                        class="w-full"
                                    />
                                </div>

                                <!-- Rotation Control -->
                                <div class="space-y-4">
                                    <div
                                        class="flex justify-between items-center mb-3"
                                    >
                                        <label
                                            for="rotationRange_2"
                                            class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                                        >
                                            <span
                                                class="w-2 h-2 bg-orange-500 rounded-full"
                                            ></span>
                                            10. Rota√ß√£o
                                        </label>
                                        <span
                                            class="text-sm font-mono font-bold text-orange-600 dark:text-orange-500 bg-orange-100 dark:bg-orange-500/10 px-3 py-1.5 rounded-md"
                                            ><span id="rotationLabel_2">0</span
                                            >¬∞</span
                                        >
                                    </div>

                                    <div class="flex items-center gap-4">
                                        <button
                                            id="rotateLeftBtn_2"
                                            class="shrink-0 w-10 h-10 bg-neutral-200 dark:bg-neutral-800 hover:bg-neutral-300 dark:hover:bg-neutral-700 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-100 rounded-md transition-colors border border-neutral-300 dark:border-neutral-700 flex items-center justify-center"
                                            title="-90¬∞"
                                        >
                                            <svg
                                                width="14"
                                                height="14"
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                stroke="currentColor"
                                                stroke-width="2"
                                            >
                                                <path
                                                    d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"
                                                />
                                                <path d="M3 3v5h5" />
                                            </svg>
                                        </button>

                                        <input
                                            type="range"
                                            id="rotationRange_2"
                                            min="-180"
                                            max="180"
                                            value="0"
                                            class="flex-1"
                                        />

                                        <button
                                            id="rotateRightBtn_2"
                                            class="shrink-0 w-10 h-10 bg-neutral-200 dark:bg-neutral-800 hover:bg-neutral-300 dark:hover:bg-neutral-700 text-neutral-500 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-100 rounded-md transition-colors border border-neutral-300 dark:border-neutral-700 flex items-center justify-center"
                                            title="+90¬∞"
                                        >
                                            <svg
                                                width="14"
                                                height="14"
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                stroke="currentColor"
                                                stroke-width="2"
                                            >
                                                <path
                                                    d="M21 12a9 9 0 1 1-9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"
                                                />
                                                <path d="M21 3v5h-5" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="h-px bg-neutral-300 dark:bg-neutral-700 w-full my-8"
                            ></div>

                            <!-- Print Size and Colors - Side by Side -->
                            <div class="grid grid-cols-2 gap-6">
                                <!-- Print Size -->
                                <div class="space-y-3">
                                    <label
                                        for="printSize_2"
                                        class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                                    >
                                        <span
                                            class="w-2 h-2 bg-orange-500 rounded-full"
                                        ></span>
                                        11. Dimens√£o de Impress√£o
                                    </label>
                                    <input
                                        type="text"
                                        id="printSize_2"
                                        placeholder="10x10cm"
                                        class="w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-950/30 border border-neutral-200 dark:border-neutral-800 rounded-md text-sm text-neutral-900 dark:text-neutral-100 placeholder-neutral-500 dark:placeholder-neutral-600 focus:outline-none focus:border-orange-500 transition-colors font-mono"
                                    />
                                </div>

                                <!-- Number of Colors -->
                                <div class="space-y-3">
                                    <label
                                        for="numColors_2"
                                        class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                                    >
                                        <span
                                            class="w-2 h-2 bg-orange-500 rounded-full"
                                        ></span>
                                        12. Cores
                                    </label>
                                    <input
                                        type="number"
                                        id="numColors_2"
                                        min="1"
                                        max="99"
                                        placeholder="1"
                                        class="w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-950/30 border border-neutral-200 dark:border-neutral-800 rounded-md text-sm text-neutral-900 dark:text-neutral-100 placeholder-neutral-500 dark:placeholder-neutral-600 focus:outline-none focus:border-orange-500 transition-colors font-mono"
                                    />
                                </div>
                            </div>

                            <!-- Mode Toggle -->
                            <div class="space-y-4">
                                <label
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2 mb-3"
                                >
                                    <span
                                        class="w-2 h-2 bg-orange-500 rounded-full"
                                    ></span>
                                    13. Modo de Renderiza√ß√£o
                                </label>
                                <div class="flex gap-2">
                                    <button
                                        id="mode2D_2"
                                        class="flex-1 py-2.5 px-4 text-xs font-mono font-bold rounded-md transition-all border-2 bg-orange-500 text-white border-orange-500"
                                    >
                                        SOBREPOSI√á√ÉO 2D
                                    </button>
                                    <button
                                        id="modePerspective_2"
                                        class="flex-1 py-2.5 px-4 text-xs font-mono font-bold rounded-md transition-all border-2 border-neutral-300 dark:border-neutral-700 text-neutral-600 dark:text-neutral-400 hover:border-orange-500 hover:text-orange-500"
                                    >
                                        PERSPECTIVA
                                    </button>
                                </div>
                                <!-- Perspective Controls (Instructions + Toggle) -->
                                <div
                                    id="perspectiveControls_2"
                                    style="display: none"
                                    class="mt-3 space-y-2"
                                >
                                    <p
                                        class="text-xs text-neutral-500 dark:text-neutral-600 font-mono"
                                    >
                                        <span id="modeDesc_2"
                                            >Arraste os cantos para ajustar a
                                            perspectiva manualmente</span
                                        >
                                    </p>
                                    <div id="lockPerspectiveContainer_2">
                                        <label
                                            class="flex items-center gap-2 cursor-pointer select-none group"
                                        >
                                            <input
                                                type="checkbox"
                                                id="lockPerspective_2"
                                                class="w-4 h-4 text-orange-500 rounded border-neutral-300 focus:ring-orange-500 transition-colors cursor-pointer"
                                            />
                                            <span
                                                class="text-xs font-mono text-neutral-500 dark:text-neutral-400 group-hover:text-neutral-900 dark:group-hover:text-neutral-200 transition-colors"
                                            >
                                                BLOQUEAR PERSPETIVA & USAR
                                                SLIDERS
                                            </span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Add after the mode toggle section -->
                            <div class="space-y-4">
                                <label
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2 mb-3"
                                >
                                    <span
                                        class="w-2 h-2 bg-orange-500 rounded-full"
                                    ></span>
                                    14. Efeito de Grava√ß√£o
                                </label>
                                <select
                                    id="engravingEffect_2"
                                    class="w-full px-4 py-3 bg-neutral-100 dark:bg-neutral-950/30 border border-neutral-200 dark:border-neutral-800 rounded-md text-sm text-neutral-900 dark:text-neutral-100 focus:outline-none focus:border-orange-500 transition-colors font-mono cursor-pointer [&>option]:bg-white [&>option]:text-neutral-900 dark:[&>option]:bg-neutral-900 dark:[&>option]:text-neutral-100 [&>optgroup]:bg-white [&>optgroup]:text-neutral-900 dark:[&>optgroup]:bg-neutral-900 dark:[&>optgroup]:text-neutral-100"
                                >
                                    <option value="none">
                                        Sem Efeito (Normal)
                                    </option>
                                    <optgroup label="Madeira">
                                        <option value="wood-dark">
                                            Madeira - Grava√ß√£o Escura (Padr√£o)
                                        </option>
                                        <option value="wood-dark-deep">
                                            Madeira - Queimadura Profunda
                                        </option>
                                        <option value="wood-light">
                                            Madeira - Grava√ß√£o Leve
                                        </option>
                                    </optgroup>
                                    <optgroup label="Metal">
                                        <option value="metal-light">
                                            Metal - Grava√ß√£o Clara (Padr√£o)
                                        </option>
                                        <option value="metal-laser-white">
                                            Metal - Laser Branco (Intenso)
                                        </option>
                                        <option value="metal-dark">
                                            Metal - Grava√ß√£o Escura (Padr√£o)
                                        </option>
                                        <option value="metal-anneal-black">
                                            Metal - Laser Preto (Intenso)
                                        </option>
                                    </optgroup>
                                    <optgroup label="Outros">
                                        <option value="leather-emboss">
                                            Couro - Baixo Relevo
                                        </option>
                                    </optgroup>
                                </select>
                                <p
                                    id="engravingDesc_2"
                                    class="text-xs text-neutral-500 dark:text-neutral-600 font-mono"
                                >
                                    Selecione o tipo de grava√ß√£o a laser
                                </p>
                            </div>
                        </div>

                        <div
                            class="mt-10 pt-8 border-t border-neutral-300 dark:border-neutral-700 space-y-3"
                        >
                            <button
                                id="presentationBtn"
                                disabled
                                class="w-full py-4 px-6 bg-neutral-800 hover:bg-neutral-900 active:bg-black dark:bg-neutral-700 dark:hover:bg-neutral-600 disabled:bg-neutral-300 dark:disabled:bg-neutral-800 disabled:text-neutral-500 dark:disabled:text-neutral-600 disabled:cursor-not-allowed text-white font-bold rounded-lg shadow-xl shadow-neutral-500/30 disabled:shadow-none transition-all flex items-center justify-center gap-3 uppercase tracking-widest text-sm"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    width="20"
                                    height="20"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2.5"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                >
                                    <rect
                                        x="2"
                                        y="3"
                                        width="20"
                                        height="14"
                                        rx="2"
                                        ry="2"
                                    ></rect>
                                    <line x1="8" y1="21" x2="16" y2="21"></line>
                                    <line
                                        x1="12"
                                        y1="17"
                                        x2="12"
                                        y2="21"
                                    ></line>
                                </svg>
                                Apresenta√ß√£o Desktop
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Presentation Overlay - ALWAYS LIGHT MODE -->
        <div
            id="presentationOverlay"
            class="hidden fixed inset-0 z-[100] bg-neutral-100 flex flex-col overflow-hidden font-sans"
        >
            <!-- Controls -->
            <div class="absolute top-4 right-4 z-50 flex items-center gap-2">
                <button
                    id="exportPresentationBtn"
                    class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg shadow-lg transition-colors text-sm flex items-center gap-2"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="7 10 12 15 17 10" />
                        <line x1="12" y1="15" x2="12" y2="3" />
                    </svg>
                    Export JPG (150dpi)
                </button>
                <button
                    id="closePresentation"
                    class="p-2 bg-white/10 hover:bg-black/10 rounded-full text-neutral-500 hover:text-neutral-900 transition-colors"
                >
                    <svg
                        class="w-8 h-8"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M6 18L18 6M6 6l12 12"
                        />
                    </svg>
                </button>
            </div>

            <div class="flex-1 flex w-full h-full">
                <!-- Sidebar: LIGHT MODE ONLY -->
                <div
                    class="w-[400px] shrink-0 bg-neutral-50 p-8 flex flex-col border-r border-neutral-200"
                >
                    <!-- Logo -->
                    <div class="mb-10">
                        <img
                            id="sidebarLogo"
                            src="Logo_Geral_600px_positivo.png"
                            alt="IMACX"
                            class="h-8 mb-2"
                        />
                    </div>

                    <!-- Details Grid -->
                    <div class="flex flex-col gap-6 flex-1">
                        <!-- Client & Ref -->
                        <div
                            class="p-6 bg-white rounded-lg border border-neutral-200 shadow-md relative z-10 space-y-3"
                        >
                            <h3
                                class="text-xs font-mono uppercase tracking-wider text-neutral-500 flex items-center gap-2"
                            >
                                <span
                                    class="w-2 h-2 bg-orange-500 rounded-full"
                                ></span>
                                Cliente
                            </h3>
                            <div>
                                <p
                                    id="presClient"
                                    class="font-bold text-lg text-neutral-900 leading-none mb-1 uppercase"
                                >
                                    Client Name
                                </p>
                            </div>
                        </div>

                        <!-- Article -->
                        <div
                            class="p-6 bg-white rounded-lg border border-neutral-200 shadow-md relative z-10 space-y-3"
                        >
                            <h3
                                class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 flex items-center gap-2"
                            >
                                <span
                                    class="w-2 h-2 bg-orange-500 rounded-full"
                                ></span>
                                Artigo
                            </h3>
                            <div>
                                <p
                                    id="presTitle"
                                    class="font-bold text-xl text-neutral-900 leading-tight mb-1 uppercase"
                                >
                                    Product Title
                                </p>
                                <p
                                    id="presRef"
                                    class="font-mono text-xs text-neutral-500 mb-2"
                                >
                                    REF: 00000
                                </p>
                                <p
                                    id="presDesc"
                                    class="text-xs text-neutral-600 leading-relaxed"
                                >
                                    Description goes here...
                                </p>
                            </div>
                        </div>

                        <!-- Specs Grid -->
                        <div
                            class="grid grid-cols-3 gap-4 p-4 bg-white rounded-lg border border-neutral-200 shadow-md relative z-10"
                        >
                            <div>
                                <h3
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 mb-1"
                                >
                                    POSI√á√ÉO 1
                                </h3>
                                <p
                                    id="presPosition"
                                    class="font-mono text-sm font-bold text-neutral-900"
                                >
                                    A
                                </p>
                            </div>
                            <div>
                                <h3
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 mb-1"
                                >
                                    DIMENS√ÉO IMPRESS√ÉO
                                </h3>
                                <p
                                    id="presSize"
                                    class="font-mono text-sm font-bold text-neutral-900"
                                >
                                    --
                                </p>
                            </div>
                            <div>
                                <h3
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 mb-1"
                                >
                                    N¬∫ CORES
                                </h3>
                                <p
                                    id="presColors"
                                    class="font-mono text-sm font-bold text-neutral-900"
                                >
                                    --
                                </p>
                            </div>
                            <div class="col-span-3">
                                <h3
                                    class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 mb-1"
                                >
                                    QUANTIDADES
                                </h3>
                                <p
                                    id="presQty"
                                    class="font-mono text-sm font-bold text-neutral-900"
                                >
                                    --
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Footer Info -->
                    <div
                        class="mt-auto pt-8 text-[10px] text-neutral-400 font-mono"
                    >
                        <p>IMACX.PT</p>
                    </div>
                </div>

                <!-- Main: Image -->
                <div class="flex-1 bg-white relative flex flex-col p-8">
                    <!-- Header Bar in Main -->
                    <div
                        class="flex justify-between items-center mb-4 pb-4 border-b border-neutral-100"
                    >
                        <div class="flex items-center gap-2">
                            <span
                                class="w-2 h-2 bg-green-500 rounded-full animate-pulse"
                            ></span>
                            <span
                                class="text-xs font-mono uppercase tracking-widest text-neutral-400"
                                >Mockup Preview</span
                            >
                        </div>
                        <div
                            class="text-xs font-mono text-neutral-400"
                            id="presCurrentDate"
                        >
                            <!-- Date JS -->
                        </div>
                    </div>

                    <!-- Image Container -->
                    <div
                        class="flex-1 flex items-center justify-center overflow-hidden bg-neutral-50 rounded-lg border border-dashed border-neutral-200 relative"
                    >
                        <img
                            id="presImage"
                            src=""
                            alt="Mockup"
                            class="max-w-full max-h-full object-contain shadow-2xl"
                        />
                    </div>

                    <!-- Disclaimer Footer (Clean, No Orange Background) -->
                    <div class="mt-6 pt-4 border-t border-neutral-200">
                        <p
                            class="text-[10px] leading-relaxed text-neutral-600 text-center max-w-4xl mx-auto font-medium"
                        >
                            <span
                                class="text-orange-600 font-bold uppercase mr-1"
                                >Nota Importante:</span
                            >
                            A fim de garantir a qualidade e exatid√£o do
                            trabalho, √© favor confirmar a maqueta enviada:
                            pantone, dimens√µes da imagem e posicionamento da
                            mesma. √â da responsabilidade do cliente verificar a
                            totalidade do documento enviado e posteriormente
                            aprovar. A aprova√ß√£o da maqueta vincula a produ√ß√£o.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Theme toggle
            const themeToggle = document.getElementById("themeToggle");
            const html = document.documentElement;

            // Logo element
            const mainLogo = document.getElementById("mainLogo");

            function updateLogo(theme) {
                if (theme === "dark") {
                    mainLogo.src = "LOGOS/imacx_neg.svg";
                } else {
                    mainLogo.src = "LOGOS/imacx_pos.svg";
                }
            }

            // Check for saved theme preference or default to 'dark'
            const currentTheme = localStorage.getItem("theme") || "dark";
            html.classList.toggle("dark", currentTheme === "dark");
            updateLogo(currentTheme);

            themeToggle.addEventListener("click", () => {
                html.classList.toggle("dark");
                const theme = html.classList.contains("dark")
                    ? "dark"
                    : "light";
                localStorage.setItem("theme", theme);
                updateLogo(theme);
            });

            // Nova button - refresh page
            document.getElementById("novaBtn").addEventListener("click", () => {
                if (
                    confirm(
                        "Tem a certeza que deseja come√ßar uma nova apresenta√ß√£o? Todas as altera√ß√µes n√£o guardadas ser√£o perdidas.",
                    )
                ) {
                    location.reload();
                }
            });

            // Help modal toggle
            const helpToggle = document.getElementById("helpToggle");
            const helpModal = document.getElementById("helpModal");
            const closeHelp = document.getElementById("closeHelp");

            helpToggle.addEventListener("click", () => {
                helpModal.classList.remove("hidden");
            });

            closeHelp.addEventListener("click", () => {
                helpModal.classList.add("hidden");
            });

            // Close modal when clicking outside
            helpModal.addEventListener("click", (e) => {
                if (e.target === helpModal) {
                    helpModal.classList.add("hidden");
                }
            });

            // Canvas & Mockup Logic
            const canvas = document.getElementById("mockupCanvas");
            const ctx = canvas.getContext("2d");
            const productInput = document.getElementById("productInput");
            const logoInput = document.getElementById("logoInput");
            const scaleRange = document.getElementById("scaleRange");
            const scaleLabel = document.getElementById("scaleLabel");
            const rotationRange = document.getElementById("rotationRange");
            const rotationLabel = document.getElementById("rotationLabel");
            const rotateLeftBtn = document.getElementById("rotateLeftBtn");
            const rotateRightBtn = document.getElementById("rotateRightBtn");
            const emptyState = document.getElementById("emptyState");
            const mode2DBtn = document.getElementById("mode2D");
            const modePerspectiveBtn =
                document.getElementById("modePerspective");
            const lockPerspectiveCheckbox =
                document.getElementById("lockPerspective");
            const perspectiveControls = document.getElementById(
                "perspectiveControls",
            );
            const removeBgBtn = document.getElementById("removeBgBtn");
            const modeDesc = document.getElementById("modeDesc");
            // Elements - Position 2
            const productInput_2 = document.getElementById("productInput_2");
            const logoInput_2 = document.getElementById("logoInput_2");
            const scaleRange_2 = document.getElementById("scaleRange_2");
            const scaleLabel_2 = document.getElementById("scaleLabel_2");
            const rotationRange_2 = document.getElementById("rotationRange_2");
            const rotationLabel_2 = document.getElementById("rotationLabel_2");
            const rotateLeftBtn_2 = document.getElementById("rotateLeftBtn_2");
            const rotateRightBtn_2 =
                document.getElementById("rotateRightBtn_2");
            const mode2DBtn_2 = document.getElementById("mode2D_2");
            const modePerspectiveBtn_2 =
                document.getElementById("modePerspective_2");
            const lockPerspectiveCheckbox_2 =
                document.getElementById("lockPerspective_2");
            const perspectiveControls_2 = document.getElementById(
                "perspectiveControls_2",
            );
            const modeDesc_2 = document.getElementById("modeDesc_2");
            const removeBgBtn_2 = document.getElementById("removeBgBtn_2");

            // Tabs
            const tabPos1 = document.getElementById("tabPos1");
            const tabPos2 = document.getElementById("tabPos2");
            const controlsPos1 = document.getElementById("controlsPos1");
            const controlsPos2 = document.getElementById("controlsPos2");

            // State - Position 1
            let productImg = null;
            let logoImg = null;
            let productBase64 = null;
            let logoBase64 = null;
            let logoScale = 0.5;
            let logoRotation = 0;
            let logoX = canvas.width * 0.5;
            let logoY = canvas.height * 0.5;
            let perspectiveMode = false;
            let perspectiveLocked = false;
            let logoCorners = null;

            // State - Position 2
            let productImg_2 = null;
            let productBase64_2 = null;
            let logoImg2 = null;
            let logoBase64_2 = null;
            let logoScale_2 = 0.5;
            let logoRotation_2 = 0;
            let logoX_2 = canvas.width * 0.5;
            let logoY_2 = canvas.height * 0.5;
            let perspectiveMode_2 = false;
            let perspectiveLocked_2 = false;
            let logoCorners_2 = null;

            // Shared State
            let renderMode = "2D";
            let engravingEffect = "none";
            let engravingEffect_2 = "none";
            let activeTab = 1;
            let isDragging = false;
            let dragOffsetX = 0;
            let dragOffsetY = 0;
            let draggingCorner = null;
            let draggingAllCorners = false;
            let dragStartX = 0;
            let dragStartY = 0;
            let initialCorners = null;

            // Tab Logic
            // Tab Logic
            function switchTab(tab) {
                activeTab = tab;
                const activeClasses = [
                    "text-orange-500",
                    "bg-white",
                    "dark:bg-neutral-800",
                    "shadow-sm",
                ];
                const inactiveClasses = [
                    "text-neutral-500",
                    "dark:text-neutral-400",
                    "hover:text-neutral-700",
                    "dark:hover:text-neutral-200",
                    "hover:bg-white/50",
                    "dark:hover:bg-neutral-800/50",
                ];

                if (tab === 1) {
                    tabPos1.classList.add(...activeClasses);
                    tabPos1.classList.remove(...inactiveClasses);

                    tabPos2.classList.remove(...activeClasses);
                    tabPos2.classList.add(...inactiveClasses);

                    controlsPos1.classList.remove("hidden");
                    controlsPos2.classList.add("hidden");
                } else {
                    tabPos2.classList.add(...activeClasses);
                    tabPos2.classList.remove(...inactiveClasses);

                    tabPos1.classList.remove(...activeClasses);
                    tabPos1.classList.add(...inactiveClasses);

                    controlsPos2.classList.remove("hidden");
                    controlsPos1.classList.add("hidden");
                }
                draw();
            }

            tabPos1.addEventListener("click", () => switchTab(1));
            tabPos2.addEventListener("click", () => switchTab(2));
            const CORNER_RADIUS = 8;

            function loadImageFromFile(file, callback) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    const base64 = e.target.result;
                    img.onload = () => callback(img, base64);
                    img.src = base64;
                };
                reader.readAsDataURL(file);
            }

            productInput.addEventListener("change", (e) => {
                const file = e.target.files[0];
                if (!file) return;

                loadImageFromFile(file, (img, base64) => {
                    productImg = img;
                    productBase64 = base64;
                    if (productImg) {
                        emptyState.style.display = "none";
                    }
                    fitCanvasToProduct();
                    draw();
                    updateDownloadState();
                });
            });

            productInput_2.addEventListener("change", (e) => {
                const file = e.target.files[0];
                if (!file) return;

                loadImageFromFile(file, (img, base64) => {
                    productImg_2 = img;
                    productBase64_2 = base64;
                    if (activeTab === 2 && productImg_2) {
                        emptyState.style.display = "none";
                    }
                    fitCanvasToProduct();
                    draw();
                    updateDownloadState();
                });
            });

            logoInput.addEventListener("change", async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                // Check for unsupported formats
                const fileName = file.name.toLowerCase();
                if (fileName.endsWith(".ai") || fileName.endsWith(".cdr")) {
                    alert(
                        "‚ùå FORMATO N√ÉO SUPORTADO\n\n" +
                            "Arquivos AI e CDR n√£o funcionam no navegador.\n\n" +
                            "‚úÖ SOLU√á√ÉO: Exporte o logo como PDF ou PNG no seu software de design.",
                    );
                    logoInput.value = "";
                    return;
                }

                // Handle PDF files
                if (file.type === "application/pdf") {
                    try {
                        const { img, dataUrl } = await loadPDFAsImage(file);
                        logoImg = img;
                        logoBase64 = dataUrl;
                        logoX = canvas.width * 0.5;
                        logoY = canvas.height * 0.5;
                        removeBgBtn.disabled = false;
                        draw();
                        updateDownloadState();
                    } catch (error) {
                        alert("Erro ao carregar PDF: " + error.message);
                        logoInput.value = "";
                    }
                    return;
                }

                // Handle regular images
                loadImageFromFile(file, (img, base64) => {
                    logoImg = img;
                    logoBase64 = base64;
                    logoX = canvas.width * 0.5;
                    logoY = canvas.height * 0.5;
                    removeBgBtn.disabled = false;
                    draw();
                    updateDownloadState();
                });
            });

            logoInput_2.addEventListener("change", async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                // Check for unsupported formats
                const fileName = file.name.toLowerCase();
                if (fileName.endsWith(".ai") || fileName.endsWith(".cdr")) {
                    alert(
                        "‚ùå FORMATO N√ÉO SUPORTADO\n\n" +
                            "Arquivos AI e CDR n√£o funcionam no navegador.\n\n" +
                            "‚úÖ SOLU√á√ÉO: Exporte o logo como PDF ou PNG no seu software de design.",
                    );
                    logoInput_2.value = "";
                    return;
                }

                // Handle PDF files
                if (file.type === "application/pdf") {
                    try {
                        const { img, dataUrl } = await loadPDFAsImage(file);
                        logoImg2 = img;
                        logoBase64_2 = dataUrl;
                        logoX_2 = canvas.width * 0.5;
                        logoY_2 = canvas.height * 0.5;
                        removeBgBtn_2.disabled = false;
                        draw();
                        updateDownloadState();
                    } catch (error) {
                        alert("Erro ao carregar PDF: " + error.message);
                        logoInput_2.value = "";
                    }
                    return;
                }

                // Handle regular images
                loadImageFromFile(file, (img, base64) => {
                    logoImg2 = img;
                    logoBase64_2 = base64;
                    logoX_2 = canvas.width * 0.5;
                    logoY_2 = canvas.height * 0.5;
                    removeBgBtn_2.disabled = false;
                    draw();
                    updateDownloadState();
                });
            });

            // PDF Loading Function
            async function loadPDFAsImage(file) {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer })
                    .promise;
                const page = await pdf.getPage(1);

                const viewport = page.getViewport({ scale: 2.0 });
                const pdfCanvas = document.createElement("canvas");
                const pdfCtx = pdfCanvas.getContext("2d");
                pdfCanvas.width = viewport.width;
                pdfCanvas.height = viewport.height;

                await page.render({
                    canvasContext: pdfCtx,
                    viewport: viewport,
                }).promise;

                const dataUrl = pdfCanvas.toDataURL("image/png");

                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => {
                        resolve({ img, dataUrl });
                    };
                    img.src = dataUrl;
                });
            }

            // Background Removal Modal
            const bgRemovalModal = document.getElementById("bgRemovalModal");
            // removeBgBtn and removeBgBtn_2 are already defined
            const closeBgRemoval = document.getElementById("closeBgRemoval");
            const cancelBgRemoval = document.getElementById("cancelBgRemoval");
            const applyBgRemoval = document.getElementById("applyBgRemoval");
            const bgOriginalCanvas =
                document.getElementById("bgRemovalOriginal");
            const bgPreviewCanvas = document.getElementById("bgRemovalPreview");
            const selectedColorDiv = document.getElementById("selectedColor");
            const toleranceRange = document.getElementById("toleranceRange");
            const toleranceValue = document.getElementById("toleranceValue");

            let originalImageData = null;
            let selectedBgColor = { r: 255, g: 255, b: 255 };
            let tolerance = 30;
            let originalLogoImg = null; // Stores original logo for undo
            let editingLogoTarget = 1; // 1 or 2

            function openBgRemoval(targetImg) {
                if (!targetImg) return;

                // Save original if this is first time editing
                if (!originalLogoImg) {
                    originalLogoImg = targetImg;
                }

                // Setup canvases
                const maxSize = 500;
                const scale = Math.min(
                    maxSize / targetImg.width,
                    maxSize / targetImg.height,
                );
                const w = targetImg.width * scale;
                const h = targetImg.height * scale;

                bgOriginalCanvas.width = w;
                bgOriginalCanvas.height = h;
                bgPreviewCanvas.width = w;
                bgPreviewCanvas.height = h;

                const origCtx = bgOriginalCanvas.getContext("2d");
                origCtx.drawImage(targetImg, 0, 0, w, h);
                originalImageData = origCtx.getImageData(0, 0, w, h);

                // Initial preview
                updateBgPreview();
                updatePreviewDisplay();

                bgRemovalModal.classList.remove("hidden");
            }

            removeBgBtn.addEventListener("click", () => {
                editingLogoTarget = 1;
                openBgRemoval(logoImg);
            });

            removeBgBtn_2.addEventListener("click", () => {
                editingLogoTarget = 2;
                openBgRemoval(logoImg2);
            });

            closeBgRemoval.addEventListener("click", () => {
                bgRemovalModal.classList.add("hidden");
                originalLogoImg = null;
            });

            cancelBgRemoval.addEventListener("click", () => {
                bgRemovalModal.classList.add("hidden");
                originalLogoImg = null;
            });

            const undoBgRemoval = document.getElementById("undoBgRemoval");

            undoBgRemoval.addEventListener("click", () => {
                if (originalLogoImg) {
                    if (editingLogoTarget === 1) {
                        logoImg = originalLogoImg;
                        logoBase64 = originalLogoImg.src;
                    } else {
                        logoImg2 = originalLogoImg;
                        logoBase64_2 = originalLogoImg.src;
                    }
                    originalLogoImg = null;
                    draw();
                    bgRemovalModal.classList.add("hidden");
                    document.getElementById("undoBgRemoval").disabled = true;
                }
            });

            bgOriginalCanvas.addEventListener("click", (e) => {
                const rect = bgOriginalCanvas.getBoundingClientRect();
                const x = Math.floor(
                    (e.clientX - rect.left) *
                        (bgOriginalCanvas.width / rect.width),
                );
                const y = Math.floor(
                    (e.clientY - rect.top) *
                        (bgOriginalCanvas.height / rect.height),
                );

                const ctx = bgOriginalCanvas.getContext("2d");
                const pixel = ctx.getImageData(x, y, 1, 1).data;

                selectedBgColor = { r: pixel[0], g: pixel[1], b: pixel[2] };
                selectedColorDiv.style.background = `rgb(${pixel[0]}, ${pixel[1]}, ${pixel[2]})`;

                updateBgPreview();
            });

            toleranceRange.addEventListener("input", () => {
                tolerance = parseInt(toleranceRange.value);
                toleranceValue.textContent = tolerance;
                updateBgPreview();
            });

            // Mode change listener
            document
                .querySelectorAll('input[name="bgMode"]')
                .forEach((radio) => {
                    radio.addEventListener("change", () => {
                        updateBgPreview();
                        updatePreviewDisplay();
                    });
                });

            function updatePreviewDisplay() {
                const bgMode = document.querySelector(
                    'input[name="bgMode"]:checked',
                ).value;
                const previewTitle =
                    document.getElementById("previewModeTitle");

                if (bgMode === "transparent") {
                    previewTitle.textContent = "Preview (Tornar Transparente)";
                } else {
                    previewTitle.textContent = "Preview (Mudar para Branco)";
                }
            }

            function updateBgPreview() {
                if (!originalImageData) return;

                const bgMode = document.querySelector(
                    'input[name="bgMode"]:checked',
                ).value;
                const data = new Uint8ClampedArray(originalImageData.data);
                const { r, g, b } = selectedBgColor;

                for (let i = 0; i < data.length; i += 4) {
                    const dr = Math.abs(data[i] - r);
                    const dg = Math.abs(data[i + 1] - g);
                    const db = Math.abs(data[i + 2] - b);
                    const diff = Math.max(dr, dg, db);

                    if (bgMode === "blackwhite") {
                        // Convert all colors to black or white based on luminance
                        // Skip fully transparent pixels
                        if (data[i + 3] > 0) {
                            const luminance =
                                0.299 * data[i] +
                                0.587 * data[i + 1] +
                                0.114 * data[i + 2];
                            const threshold = 128; // Middle point
                            if (luminance > threshold) {
                                // Convert to white
                                data[i] = 255;
                                data[i + 1] = 255;
                                data[i + 2] = 255;
                            } else {
                                // Convert to black
                                data[i] = 0;
                                data[i + 1] = 0;
                                data[i + 2] = 0;
                            }
                        }
                    } else if (diff <= tolerance * 2.55) {
                        if (bgMode === "transparent") {
                            data[i + 3] = 0; // Make transparent
                        } else {
                            // Change to white
                            data[i] = 255; // R
                            data[i + 1] = 255; // G
                            data[i + 2] = 255; // B
                            // Keep alpha as-is
                        }
                    }
                }

                const previewCtx = bgPreviewCanvas.getContext("2d");
                const imageData = new ImageData(
                    data,
                    originalImageData.width,
                    originalImageData.height,
                );
                previewCtx.putImageData(imageData, 0, 0);
            }

            applyBgRemoval.addEventListener("click", () => {
                // Get the transparent version
                const tempCanvas = document.createElement("canvas");
                tempCanvas.width = bgPreviewCanvas.width;
                tempCanvas.height = bgPreviewCanvas.height;
                const tempCtx = tempCanvas.getContext("2d");
                tempCtx.drawImage(bgPreviewCanvas, 0, 0);

                const dataUrl = tempCanvas.toDataURL("image/png");

                const img = new Image();
                img.onload = () => {
                    if (editingLogoTarget === 1) {
                        logoImg = img;
                        logoBase64 = dataUrl;
                    } else {
                        logoImg2 = img;
                        logoBase64_2 = dataUrl;
                    }
                    draw();
                    bgRemovalModal.classList.add("hidden");

                    // Enable undo button for next time
                    document.getElementById("undoBgRemoval").disabled = false;
                };
                img.src = dataUrl;
            });

            function fitCanvasToProduct() {
                const img = activeTab === 1 ? productImg : productImg_2;
                if (!img) return;
                // Keep canvas fixed size for the UI, but scale drawing
            }

            function clearCanvas() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }

            function drawProduct() {
                clearCanvas();
                const img = activeTab === 1 ? productImg : productImg_2;

                if (!img) {
                    emptyState.style.display = "flex";
                    return;
                } else {
                    emptyState.style.display = "none";
                }

                // Fit product to canvas maintaining aspect ratio
                const scale = Math.min(
                    canvas.width / img.width,
                    canvas.height / img.height,
                );
                const w = img.width * scale;
                const h = img.height * scale;
                const x = (canvas.width - w) / 2;
                const y = (canvas.height - h) / 2;

                ctx.drawImage(img, x, y, w, h);
            }

            function initializeLogoCorners() {
                const img = activeTab === 1 ? logoImg : logoImg2;
                if (!img) return;

                const currentScale = activeTab === 1 ? logoScale : logoScale_2;
                const currentX = activeTab === 1 ? logoX : logoX_2;
                const currentY = activeTab === 1 ? logoY : logoY_2;

                const baseWidth = img.width * currentScale;
                const baseHeight = img.height * currentScale;
                const hw = baseWidth / 2;
                const hh = baseHeight / 2;

                const corners = {
                    topLeft: { x: currentX - hw, y: currentY - hh },
                    topRight: { x: currentX + hw, y: currentY - hh },
                    bottomLeft: { x: currentX - hw, y: currentY + hh },
                    bottomRight: { x: currentX + hw, y: currentY + hh },
                };

                if (activeTab === 1) {
                    logoCorners = corners;
                } else {
                    logoCorners_2 = corners;
                }
            }

            function applyEngravingEffect() {
                const currentEffect =
                    activeTab === 1 ? engravingEffect : engravingEffect_2;
                switch (currentEffect) {
                    // --- WOOD EFFECTS ---
                    case "wood-dark":
                        // Standard dark burn
                        ctx.globalCompositeOperation = "multiply";
                        ctx.globalAlpha = 0.85; // Darker than before (was 0.6)
                        break;
                    case "wood-dark-deep":
                        // Intense burn
                        ctx.globalCompositeOperation = "color-burn";
                        ctx.globalAlpha = 0.8;
                        break;
                    case "wood-light":
                        // Subtle engraving
                        ctx.globalCompositeOperation = "soft-light";
                        ctx.globalAlpha = 0.9;
                        break;

                    // --- METAL EFFECTS ---
                    case "metal-light":
                        // Standard light engraving
                        ctx.globalCompositeOperation = "screen";
                        ctx.globalAlpha = 0.9; // Stronger (was 0.8)
                        break;
                    case "metal-laser-white":
                        // Intense white laser
                        ctx.globalCompositeOperation = "color-dodge";
                        ctx.globalAlpha = 0.8;
                        break;
                    case "metal-dark":
                        // Standard dark oxidation
                        ctx.globalCompositeOperation = "multiply";
                        ctx.globalAlpha = 0.7; // Darker (was 0.5)
                        break;
                    case "metal-anneal-black":
                        // Intense black annealing
                        ctx.globalCompositeOperation = "color-burn";
                        ctx.globalAlpha = 0.7;
                        break;

                    // --- OTHER EFFECTS ---
                    case "leather-emboss":
                        // Emboss simulation
                        ctx.globalCompositeOperation = "overlay";
                        ctx.globalAlpha = 0.9;
                        break;

                    default:
                        // No effect
                        ctx.globalCompositeOperation = "source-over";
                        ctx.globalAlpha = 1.0;
                }
            }

            function drawLogo() {
                const img = activeTab === 1 ? logoImg : logoImg2;
                if (!img) return;

                const currentScale = activeTab === 1 ? logoScale : logoScale_2;
                const currentRotation =
                    activeTab === 1 ? logoRotation : logoRotation_2;
                const currentX = activeTab === 1 ? logoX : logoX_2;
                const currentY = activeTab === 1 ? logoY : logoY_2;
                const currentPerspective =
                    activeTab === 1 ? perspectiveMode : perspectiveMode_2;
                const currentCorners =
                    activeTab === 1 ? logoCorners : logoCorners_2;

                if (currentPerspective && currentCorners) {
                    // Draw with perspective transform using homography
                    drawLogoPerspective(img, currentCorners);
                } else {
                    // Draw normal 2D with rotation
                    const baseWidth = img.width * currentScale;
                    const baseHeight = img.height * currentScale;

                    ctx.save();

                    // Apply engraving effects based on selection
                    applyEngravingEffect();

                    ctx.translate(currentX, currentY);
                    ctx.rotate(currentRotation);
                    ctx.drawImage(
                        img,
                        -baseWidth / 2,
                        -baseHeight / 2,
                        baseWidth,
                        baseHeight,
                    );
                    ctx.restore();
                }
            }

            function drawLogoPerspective(img, corners) {
                // Use simple affine transform approximation for performance
                const centerX =
                    (corners.topLeft.x +
                        corners.topRight.x +
                        corners.bottomLeft.x +
                        corners.bottomRight.x) /
                    4;
                const centerY =
                    (corners.topLeft.y +
                        corners.topRight.y +
                        corners.bottomLeft.y +
                        corners.bottomRight.y) /
                    4;

                const topWidth = Math.sqrt(
                    Math.pow(corners.topRight.x - corners.topLeft.x, 2) +
                        Math.pow(corners.topRight.y - corners.topLeft.y, 2),
                );
                const bottomWidth = Math.sqrt(
                    Math.pow(corners.bottomRight.x - corners.bottomLeft.x, 2) +
                        Math.pow(
                            corners.bottomRight.y - corners.bottomLeft.y,
                            2,
                        ),
                );
                const leftHeight = Math.sqrt(
                    Math.pow(corners.bottomLeft.x - corners.topLeft.x, 2) +
                        Math.pow(corners.bottomLeft.y - corners.topLeft.y, 2),
                );
                const rightHeight = Math.sqrt(
                    Math.pow(corners.bottomRight.x - corners.topRight.x, 2) +
                        Math.pow(corners.bottomRight.y - corners.topRight.y, 2),
                );

                const avgWidth = (topWidth + bottomWidth) / 2;
                const avgHeight = (leftHeight + rightHeight) / 2;
                const angle = Math.atan2(
                    corners.topRight.y - corners.topLeft.y,
                    corners.topRight.x - corners.topLeft.x,
                );

                const skewX =
                    (corners.bottomRight.x -
                        corners.bottomLeft.x -
                        (corners.topRight.x - corners.topLeft.x)) /
                    avgHeight;
                const skewY =
                    (corners.bottomRight.y -
                        corners.topRight.y -
                        (corners.bottomLeft.y - corners.topLeft.y)) /
                    avgWidth;

                ctx.save();

                // Apply engraving effects
                applyEngravingEffect();

                ctx.translate(centerX, centerY);
                ctx.rotate(angle);
                ctx.transform(1, skewY, skewX, 1, 0, 0);
                ctx.drawImage(
                    img,
                    -avgWidth / 2,
                    -avgHeight / 2,
                    avgWidth,
                    avgHeight,
                );
                ctx.restore();
            }

            function draw(hideHandles = false) {
                drawProduct();
                drawLogo();

                // Draw corner handles in perspective mode (unless we're downloading or perspective is locked)
                // Check for both Position 1 and Position 2
                if (activeTab === 1) {
                    if (
                        perspectiveMode &&
                        logoCorners &&
                        !hideHandles &&
                        !perspectiveLocked
                    ) {
                        drawCornerHandles(logoCorners);
                    }
                } else {
                    if (
                        perspectiveMode_2 &&
                        logoCorners_2 &&
                        !hideHandles &&
                        !perspectiveLocked_2
                    ) {
                        drawCornerHandles(logoCorners_2);
                    }
                }
            }

            function drawCornerHandles(corners) {
                ctx.strokeStyle = "#ff6b00";
                ctx.fillStyle = "#ff6b00";
                ctx.lineWidth = 2;

                // Draw lines between corners
                ctx.beginPath();
                ctx.moveTo(corners.topLeft.x, corners.topLeft.y);
                ctx.lineTo(corners.topRight.x, corners.topRight.y);
                ctx.lineTo(corners.bottomRight.x, corners.bottomRight.y);
                ctx.lineTo(corners.bottomLeft.x, corners.bottomLeft.y);
                ctx.closePath();
                ctx.stroke();

                // Draw corner circles
                Object.values(corners).forEach((corner) => {
                    ctx.beginPath();
                    ctx.arc(corner.x, corner.y, CORNER_RADIUS, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.strokeStyle = "#fff";
                    ctx.lineWidth = 2;
                    ctx.stroke();
                });
            }

            function getCornerAtPoint(x, y) {
                if (!logoCorners) return null;

                for (let [name, corner] of Object.entries(logoCorners)) {
                    const dx = x - corner.x;
                    const dy = y - corner.y;
                    if (Math.sqrt(dx * dx + dy * dy) <= CORNER_RADIUS + 5) {
                        return name;
                    }
                }
                return null;
            }

            function isPointInPerspectiveArea(x, y) {
                if (!logoCorners) return false;

                // Simple bounding box check
                const minX = Math.min(
                    logoCorners.topLeft.x,
                    logoCorners.topRight.x,
                    logoCorners.bottomLeft.x,
                    logoCorners.bottomRight.x,
                );
                const maxX = Math.max(
                    logoCorners.topLeft.x,
                    logoCorners.topRight.x,
                    logoCorners.bottomLeft.x,
                    logoCorners.bottomRight.x,
                );
                const minY = Math.min(
                    logoCorners.topLeft.y,
                    logoCorners.topRight.y,
                    logoCorners.bottomLeft.y,
                    logoCorners.bottomRight.y,
                );
                const maxY = Math.max(
                    logoCorners.topLeft.y,
                    logoCorners.topRight.y,
                    logoCorners.bottomLeft.y,
                    logoCorners.bottomRight.y,
                );

                return x >= minX && x <= maxX && y >= minY && y <= maxY;
            }

            let previousScale = 0.5;
            let previousScale_2 = 0.5;

            document
                .getElementById("engravingEffect")
                .addEventListener("change", (e) => {
                    engravingEffect = e.target.value;
                    const desc = document.getElementById("engravingDesc");

                    switch (engravingEffect) {
                        case "wood-dark":
                            desc.textContent =
                                "Grava√ß√£o escura padr√£o em madeira";
                            break;
                        case "wood-dark-deep":
                            desc.textContent = "Queimadura profunda e intensa";
                            break;
                        case "wood-light":
                            desc.textContent = "Grava√ß√£o superficial sutil";
                            break;
                        case "metal-light":
                            desc.textContent = "Remo√ß√£o de acabamento (claro)";
                            break;
                        case "metal-laser-white":
                            desc.textContent =
                                "Marca√ß√£o a laser branco intenso";
                            break;
                        case "metal-dark":
                            desc.textContent = "Oxida√ß√£o escura em metal";
                            break;
                        case "metal-anneal-black":
                            desc.textContent =
                                "Marca√ß√£o preta intensa (Annealing)";
                            break;
                        case "leather-emboss":
                            desc.textContent =
                                "Simula√ß√£o de baixo relevo em couro";
                            break;
                        default:
                            desc.textContent = "Sem efeito aplicado";
                    }

                    draw();
                });

            document
                .getElementById("engravingEffect_2")
                .addEventListener("change", (e) => {
                    engravingEffect_2 = e.target.value;
                    const desc = document.getElementById("engravingDesc_2");

                    switch (engravingEffect_2) {
                        case "wood-dark":
                            desc.textContent =
                                "Grava√ß√£o escura padr√£o em madeira";
                            break;
                        case "wood-dark-deep":
                            desc.textContent = "Queimadura profunda e intensa";
                            break;
                        case "wood-light":
                            desc.textContent = "Grava√ß√£o superficial sutil";
                            break;
                        case "metal-light":
                            desc.textContent = "Remo√ß√£o de acabamento (claro)";
                            break;
                        case "metal-laser-white":
                            desc.textContent =
                                "Marca√ß√£o a laser branco intenso";
                            break;
                        case "metal-dark":
                            desc.textContent = "Oxida√ß√£o escura em metal";
                            break;
                        case "metal-anneal-black":
                            desc.textContent =
                                "Marca√ß√£o preta intensa (Annealing)";
                            break;
                        case "leather-emboss":
                            desc.textContent =
                                "Simula√ß√£o de baixo relevo em couro";
                            break;
                        default:
                            desc.textContent = "Sem efeito aplicado";
                    }

                    draw();
                });

            scaleRange.addEventListener("input", () => {
                const value = Number(scaleRange.value);
                scaleLabel.textContent = value;
                const newScale = value / 100;

                // If perspective is locked, scale the corners proportionally
                if (perspectiveLocked && logoCorners) {
                    const centerX =
                        (logoCorners.topLeft.x +
                            logoCorners.topRight.x +
                            logoCorners.bottomLeft.x +
                            logoCorners.bottomRight.x) /
                        4;
                    const centerY =
                        (logoCorners.topLeft.y +
                            logoCorners.topRight.y +
                            logoCorners.bottomLeft.y +
                            logoCorners.bottomRight.y) /
                        4;

                    const scaleFactor = newScale / previousScale;

                    Object.keys(logoCorners).forEach((key) => {
                        const dx = logoCorners[key].x - centerX;
                        const dy = logoCorners[key].y - centerY;
                        logoCorners[key].x = centerX + dx * scaleFactor;
                        logoCorners[key].y = centerY + dy * scaleFactor;
                    });
                }

                logoScale = newScale;
                previousScale = newScale;
                draw();
            });

            scaleRange_2.addEventListener("input", () => {
                const value = Number(scaleRange_2.value);
                scaleLabel_2.textContent = value;
                const newScale = value / 100;

                if (perspectiveLocked_2 && logoCorners_2) {
                    const centerX =
                        (logoCorners_2.topLeft.x +
                            logoCorners_2.topRight.x +
                            logoCorners_2.bottomLeft.x +
                            logoCorners_2.bottomRight.x) /
                        4;
                    const centerY =
                        (logoCorners_2.topLeft.y +
                            logoCorners_2.topRight.y +
                            logoCorners_2.bottomLeft.y +
                            logoCorners_2.bottomRight.y) /
                        4;

                    const scaleFactor = newScale / previousScale_2;

                    Object.keys(logoCorners_2).forEach((key) => {
                        const dx = logoCorners_2[key].x - centerX;
                        const dy = logoCorners_2[key].y - centerY;
                        logoCorners_2[key].x = centerX + dx * scaleFactor;
                        logoCorners_2[key].y = centerY + dy * scaleFactor;
                    });
                }

                logoScale_2 = newScale;
                previousScale_2 = newScale;
                draw();
            });

            function updateRotation(degrees) {
                let newDegrees = degrees % 360;
                if (newDegrees > 180) newDegrees -= 360;
                if (newDegrees < -180) newDegrees += 360;

                if (activeTab === 1) {
                    rotationRange.value = newDegrees;
                    rotationLabel.textContent = newDegrees;
                    logoRotation = (newDegrees * Math.PI) / 180;
                } else {
                    rotationRange_2.value = newDegrees;
                    rotationLabel_2.textContent = newDegrees;
                    logoRotation_2 = (newDegrees * Math.PI) / 180;
                }
                draw();
            }

            rotationRange.addEventListener("input", () => {
                const value = Number(rotationRange.value);
                rotationLabel.textContent = value;
                logoRotation = (value * Math.PI) / 180;
                draw();
            });

            rotationRange_2.addEventListener("input", () => {
                const value = Number(rotationRange_2.value);
                rotationLabel_2.textContent = value;
                logoRotation_2 = (value * Math.PI) / 180;
                draw();
            });

            rotateLeftBtn.addEventListener("click", () => {
                const currentDeg = Math.round((logoRotation * 180) / Math.PI);
                updateRotation(currentDeg - 90);
            });

            rotateRightBtn.addEventListener("click", () => {
                const currentDeg = Math.round((logoRotation * 180) / Math.PI);
                updateRotation(currentDeg + 90);
            });

            rotateLeftBtn_2.addEventListener("click", () => {
                const currentDeg = Math.round((logoRotation_2 * 180) / Math.PI);
                updateRotation(currentDeg - 90);
            });

            rotateRightBtn_2.addEventListener("click", () => {
                const currentDeg = Math.round((logoRotation_2 * 180) / Math.PI);
                updateRotation(currentDeg + 90);
            });

            function isPointInLogo(x, y) {
                const img = activeTab === 1 ? logoImg : logoImg2;
                if (!img) return false;

                const currentX = activeTab === 1 ? logoX : logoX_2;
                const currentY = activeTab === 1 ? logoY : logoY_2;
                const currentRotation =
                    activeTab === 1 ? logoRotation : logoRotation_2;
                const currentScale = activeTab === 1 ? logoScale : logoScale_2;

                const dx = x - currentX;
                const dy = y - currentY;
                const cos = Math.cos(-currentRotation);
                const sin = Math.sin(-currentRotation);
                const localX = dx * cos - dy * sin;
                const localY = dx * sin + dy * cos;
                const w = img.width * currentScale;
                const h = img.height * currentScale;
                return (
                    localX >= -w / 2 &&
                    localX <= w / 2 &&
                    localY >= -h / 2 &&
                    localY <= h / 2
                );
            }

            function getCornerAtPoint(x, y) {
                const corners = activeTab === 1 ? logoCorners : logoCorners_2;
                if (!corners) return null;

                for (let [name, corner] of Object.entries(corners)) {
                    const dx = x - corner.x;
                    const dy = y - corner.y;
                    if (Math.sqrt(dx * dx + dy * dy) <= CORNER_RADIUS + 5) {
                        return name;
                    }
                }
                return null;
            }

            function isPointInPerspectiveArea(x, y) {
                const corners = activeTab === 1 ? logoCorners : logoCorners_2;
                if (!corners) return false;

                // Simple bounding box check
                const minX = Math.min(
                    corners.topLeft.x,
                    corners.topRight.x,
                    corners.bottomLeft.x,
                    corners.bottomRight.x,
                );
                const maxX = Math.max(
                    corners.topLeft.x,
                    corners.topRight.x,
                    corners.bottomLeft.x,
                    corners.bottomRight.x,
                );
                const minY = Math.min(
                    corners.topLeft.y,
                    corners.topRight.y,
                    corners.bottomLeft.y,
                    corners.bottomRight.y,
                );
                const maxY = Math.max(
                    corners.topLeft.y,
                    corners.topRight.y,
                    corners.bottomLeft.y,
                    corners.bottomRight.y,
                );

                return x >= minX && x <= maxX && y >= minY && y <= maxY;
            }

            canvas.addEventListener("mousedown", (e) => {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;

                const currentPerspective =
                    activeTab === 1 ? perspectiveMode : perspectiveMode_2;
                const currentLocked =
                    activeTab === 1 ? perspectiveLocked : perspectiveLocked_2;
                const currentCorners =
                    activeTab === 1 ? logoCorners : logoCorners_2;
                const currentX = activeTab === 1 ? logoX : logoX_2;
                const currentY = activeTab === 1 ? logoY : logoY_2;

                // Check for corner dragging in perspective mode (only if not locked)
                if (currentPerspective && currentCorners) {
                    // Only allow corner dragging if not locked
                    if (!currentLocked) {
                        const corner = getCornerAtPoint(x, y);
                        if (corner) {
                            draggingCorner = corner;
                            canvas.style.cursor = "grabbing";
                            return;
                        }
                    }

                    // Always allow moving the entire logo (even when locked)
                    if (isPointInPerspectiveArea(x, y)) {
                        draggingAllCorners = true;
                        dragStartX = x;
                        dragStartY = y;
                        initialCorners = {
                            topLeft: { ...currentCorners.topLeft },
                            topRight: { ...currentCorners.topRight },
                            bottomLeft: { ...currentCorners.bottomLeft },
                            bottomRight: { ...currentCorners.bottomRight },
                        };
                        canvas.style.cursor = "grabbing";
                        return;
                    }
                }

                // Normal logo dragging
                if (isPointInLogo(x, y)) {
                    isDragging = true;
                    dragOffsetX = x - currentX;
                    dragOffsetY = y - currentY;
                    canvas.style.cursor = "grabbing";
                }
            });

            window.addEventListener("mousemove", (e) => {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;

                const currentCorners =
                    activeTab === 1 ? logoCorners : logoCorners_2;

                // Handle corner dragging
                if (draggingCorner && currentCorners) {
                    currentCorners[draggingCorner].x = x;
                    currentCorners[draggingCorner].y = y;
                    draw();
                    return;
                }
                // Handle dragging all corners (moving the logo)
                if (draggingAllCorners && currentCorners) {
                    const dx = x - dragStartX;
                    const dy = y - dragStartY;
                    currentCorners.topLeft.x = initialCorners.topLeft.x + dx;
                    currentCorners.topLeft.y = initialCorners.topLeft.y + dy;
                    currentCorners.topRight.x = initialCorners.topRight.x + dx;
                    currentCorners.topRight.y = initialCorners.topRight.y + dy;
                    currentCorners.bottomLeft.x =
                        initialCorners.bottomLeft.x + dx;
                    currentCorners.bottomLeft.y =
                        initialCorners.bottomLeft.y + dy;
                    currentCorners.bottomRight.x =
                        initialCorners.bottomRight.x + dx;
                    currentCorners.bottomRight.y =
                        initialCorners.bottomRight.y + dy;
                    draw();
                    return;
                }

                // Normal logo dragging
                if (!isDragging) return;

                if (activeTab === 1) {
                    logoX = x - dragOffsetX;
                    logoY = y - dragOffsetY;
                } else {
                    logoX_2 = x - dragOffsetX;
                    logoY_2 = y - dragOffsetY;
                }
                draw();
            });

            window.addEventListener("mouseup", () => {
                isDragging = false;
                draggingCorner = null;
                draggingAllCorners = false;
                canvas.style.cursor = "move";
            });

            function updateDownloadState() {
                const presentationBtn =
                    document.getElementById("presentationBtn");
                if (presentationBtn) {
                    const pos1Ready = productImg && logoImg;
                    const pos2Ready = productImg_2 && logoImg2;
                    presentationBtn.disabled = !(pos1Ready || pos2Ready);
                }
            }

            // Helper for text wrapping
            function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
                const words = text.split(" ");
                let line = "";

                for (let n = 0; n < words.length; n++) {
                    const testLine = line + words[n] + " ";
                    const metrics = ctx.measureText(testLine);
                    const testWidth = metrics.width;
                    if (testWidth > maxWidth && n > 0) {
                        ctx.fillText(line, x, y);
                        line = words[n] + " ";
                        y += lineHeight;
                    } else {
                        line = testLine;
                    }
                }
                ctx.fillText(line, x, y);
                return y;
            }

            // Helper to render mockup to canvas
            async function renderMockupToCanvas(
                targetCtx,
                x,
                y,
                w,
                h,
                pImg,
                lBase64,
                lScale,
                lRot,
                lX,
                lY,
                lPersp,
                lCorners,
            ) {
                if (!pImg || !lBase64) return;

                const tempCanvas = document.createElement("canvas");
                // Use canvas size to match screen composition
                const mainCanvas = document.getElementById("mockupCanvas");
                tempCanvas.width = mainCanvas.width;
                tempCanvas.height = mainCanvas.height;
                const tCtx = tempCanvas.getContext("2d");

                // Draw product
                const pImage = new Image();
                pImage.src = pImg.src;
                await new Promise((r) => (pImage.onload = r));

                const scale = Math.min(
                    tempCanvas.width / pImage.width,
                    tempCanvas.height / pImage.height,
                );
                const pw = pImage.width * scale;
                const ph = pImage.height * scale;
                const px = (tempCanvas.width - pw) / 2;
                const py = (tempCanvas.height - ph) / 2;
                tCtx.drawImage(pImage, px, py, pw, ph);

                // Draw logo
                const lImage = new Image();
                lImage.src = lBase64;
                await new Promise((r) => (lImage.onload = r));

                if (!lPersp) {
                    tCtx.save();
                    tCtx.translate(lX, lY);
                    tCtx.rotate(lRot);
                    tCtx.drawImage(
                        lImage,
                        -(lImage.width * lScale) / 2,
                        -(lImage.height * lScale) / 2,
                        lImage.width * lScale,
                        lImage.height * lScale,
                    );
                    tCtx.restore();
                } else if (lCorners) {
                    const centerX =
                        (lCorners.topLeft.x +
                            lCorners.topRight.x +
                            lCorners.bottomLeft.x +
                            lCorners.bottomRight.x) /
                        4;
                    const centerY =
                        (lCorners.topLeft.y +
                            lCorners.topRight.y +
                            lCorners.bottomLeft.y +
                            lCorners.bottomRight.y) /
                        4;

                    const topWidth = Math.sqrt(
                        Math.pow(lCorners.topRight.x - lCorners.topLeft.x, 2) +
                            Math.pow(
                                lCorners.topRight.y - lCorners.topLeft.y,
                                2,
                            ),
                    );
                    const bottomWidth = Math.sqrt(
                        Math.pow(
                            lCorners.bottomRight.x - lCorners.bottomLeft.x,
                            2,
                        ) +
                            Math.pow(
                                lCorners.bottomRight.y - lCorners.bottomLeft.y,
                                2,
                            ),
                    );
                    const leftHeight = Math.sqrt(
                        Math.pow(
                            lCorners.bottomLeft.x - lCorners.topLeft.x,
                            2,
                        ) +
                            Math.pow(
                                lCorners.bottomLeft.y - lCorners.topLeft.y,
                                2,
                            ),
                    );
                    const rightHeight = Math.sqrt(
                        Math.pow(
                            lCorners.bottomRight.x - lCorners.topRight.x,
                            2,
                        ) +
                            Math.pow(
                                lCorners.bottomRight.y - lCorners.topRight.y,
                                2,
                            ),
                    );

                    const avgWidth = (topWidth + bottomWidth) / 2;
                    const avgHeight = (leftHeight + rightHeight) / 2;
                    const angle = Math.atan2(
                        lCorners.topRight.y - lCorners.topLeft.y,
                        lCorners.topRight.x - lCorners.topLeft.x,
                    );

                    const skewX =
                        (lCorners.bottomRight.x -
                            lCorners.bottomLeft.x -
                            (lCorners.topRight.x - lCorners.topLeft.x)) /
                        avgHeight;
                    const skewY =
                        (lCorners.bottomRight.y -
                            lCorners.topRight.y -
                            (lCorners.bottomLeft.y - lCorners.topLeft.y)) /
                        avgWidth;

                    tCtx.save();
                    tCtx.translate(centerX, centerY);
                    tCtx.rotate(angle);
                    tCtx.transform(1, skewY, skewX, 1, 0, 0);
                    tCtx.drawImage(
                        lImage,
                        -avgWidth / 2,
                        -avgHeight / 2,
                        avgWidth,
                        avgHeight,
                    );
                    tCtx.restore();
                }

                // Draw to target
                const drawScale = Math.min(
                    w / tempCanvas.width,
                    h / tempCanvas.height,
                );
                const dw = tempCanvas.width * drawScale;
                const dh = tempCanvas.height * drawScale;
                const dx = x + (w - dw) / 2;
                const dy = y + (h - dh) / 2;

                targetCtx.shadowColor = "rgba(0, 0, 0, 0.2)";
                targetCtx.shadowBlur = 20;
                targetCtx.shadowOffsetY = 10;
                targetCtx.drawImage(tempCanvas, dx, dy, dw, dh);
                targetCtx.shadowColor = "transparent";
            }

            // Export Presentation Button
            const exportPresentationBtn = document.getElementById(
                "exportPresentationBtn",
            );
            if (exportPresentationBtn) {
                exportPresentationBtn.addEventListener("click", async () => {
                    try {
                        exportPresentationBtn.disabled = true;
                        const originalText = exportPresentationBtn.innerHTML;
                        exportPresentationBtn.innerHTML = `Generating...`;

                        // Wait a bit for UI to update
                        await new Promise((resolve) =>
                            setTimeout(resolve, 100),
                        );

                        // Get the presentation overlay
                        const overlay = document.getElementById(
                            "presentationOverlay",
                        );

                        // Temporarily hide the export button
                        exportPresentationBtn.style.display = "none";
                        const closeBtn =
                            document.getElementById("closePresentation");
                        closeBtn.style.display = "none";

                        // Use the browser's built-in screenshot capability
                        // We'll create a canvas from the DOM elements
                        const exportCanvas = document.createElement("canvas");
                        const scale = 2; // Higher resolution
                        exportCanvas.width = 1754;
                        exportCanvas.height = 1240;
                        const ctx = exportCanvas.getContext("2d");

                        // Fill white background
                        ctx.fillStyle = "#ffffff";
                        ctx.fillRect(
                            0,
                            0,
                            exportCanvas.width,
                            exportCanvas.height,
                        );

                        // Draw sidebar background - ALWAYS LIGHT MODE
                        const sidebarWidth = 500;
                        ctx.fillStyle = "#fafafa";
                        ctx.fillRect(0, 0, sidebarWidth, exportCanvas.height);
                        ctx.strokeStyle = "#e5e5e5";
                        ctx.lineWidth = 1;
                        ctx.strokeRect(0, 0, sidebarWidth, exportCanvas.height);

                        let y = 60;
                        const xPadding = 50;
                        const cardWidth = sidebarWidth - xPadding * 2;

                        // Draw logo from PNG file
                        const logoImg = new Image();
                        logoImg.src = "Logo_Geral_600px_positivo.png";
                        await new Promise((resolve, reject) => {
                            logoImg.onload = resolve;
                            logoImg.onerror = () => resolve();
                        });

                        if (logoImg.complete && logoImg.naturalWidth > 0) {
                            const logoHeight = 60;
                            const logoRatio = logoImg.width / logoImg.height;
                            const logoWidth = logoHeight * logoRatio;
                            ctx.drawImage(
                                logoImg,
                                xPadding,
                                y,
                                logoWidth,
                                logoHeight,
                            );
                        }
                        y += 100;

                        function drawCard(yPos, height) {
                            ctx.fillStyle = "#ffffff";
                            ctx.shadowColor = "rgba(0, 0, 0, 0.1)";
                            ctx.shadowBlur = 10;
                            ctx.shadowOffsetX = 0;
                            ctx.shadowOffsetY = 4;
                            ctx.fillRect(xPadding, yPos, cardWidth, height);
                            ctx.shadowColor = "transparent";
                            ctx.strokeStyle = "#e5e5e5";
                            ctx.lineWidth = 1;
                            ctx.strokeRect(xPadding, yPos, cardWidth, height);
                            return yPos + height + 30;
                        }

                        // Client Card
                        let clientY = y;
                        const clientName =
                            document.getElementById("presClient").textContent;
                        const clientCardHeight = 120;
                        y = drawCard(clientY, clientCardHeight);

                        ctx.fillStyle = "#FF7518";
                        ctx.beginPath();
                        ctx.arc(xPadding + 20, clientY + 25, 4, 0, Math.PI * 2);
                        ctx.fill();

                        ctx.fillStyle = "#737373";
                        ctx.font = "12px monospace";
                        ctx.fillText("CLIENTE", xPadding + 35, clientY + 28);

                        ctx.fillStyle = "#171717";
                        ctx.font = "bold 24px sans-serif";
                        ctx.fillText(
                            clientName.toUpperCase(),
                            xPadding + 20,
                            clientY + 70,
                        );

                        // Article Card
                        let articleY = y;
                        const title =
                            document.getElementById("presTitle").textContent;
                        const ref =
                            document.getElementById("presRef").textContent;
                        const desc =
                            document.getElementById("presDesc").textContent;
                        const articleCardHeight = 300;
                        y = drawCard(articleY, articleCardHeight);

                        ctx.fillStyle = "#FF7518";
                        ctx.beginPath();
                        ctx.arc(
                            xPadding + 20,
                            articleY + 25,
                            4,
                            0,
                            Math.PI * 2,
                        );
                        ctx.fill();

                        ctx.fillStyle = "#737373";
                        ctx.font = "12px monospace";
                        ctx.fillText("ARTIGO", xPadding + 35, articleY + 28);

                        ctx.fillStyle = "#171717";
                        ctx.font = "bold 20px sans-serif";
                        ctx.fillText(
                            title.toUpperCase(),
                            xPadding + 20,
                            articleY + 60,
                        );

                        ctx.fillStyle = "#737373";
                        ctx.font = "14px monospace";
                        ctx.fillText(ref, xPadding + 20, articleY + 85);

                        ctx.fillStyle = "#525252";
                        ctx.font = "14px sans-serif";
                        wrapText(
                            ctx,
                            desc,
                            xPadding + 20,
                            articleY + 120,
                            cardWidth - 40,
                            20,
                        );

                        // Specs Card
                        let specsY = y;
                        const hasPos2 = !!logoImg2;
                        const specsHeight = hasPos2 ? 300 : 160;
                        y = drawCard(specsY, specsHeight);

                        ctx.fillStyle = "#FF7518";
                        ctx.beginPath();
                        ctx.arc(xPadding + 20, specsY + 25, 4, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = "#737373";
                        ctx.font = "12px monospace";
                        ctx.fillText(
                            "ESPECIFICA√á√ïES",
                            xPadding + 35,
                            specsY + 28,
                        );

                        function drawSpecsRow(
                            startY,
                            posLabel,
                            sizeVal,
                            colorsVal,
                        ) {
                            const colWidth = cardWidth / 3;

                            ctx.fillStyle = "#737373";
                            ctx.font = "12px monospace";
                            ctx.fillText(
                                "DIMENS√ÉO",
                                xPadding + 20 + colWidth,
                                startY,
                            );
                            ctx.fillStyle = "#171717";
                            ctx.font = "bold 16px monospace";
                            ctx.fillText(
                                sizeVal,
                                xPadding + 20 + colWidth,
                                startY + 25,
                            );

                            ctx.fillStyle = "#737373";
                            ctx.font = "12px monospace";
                            ctx.fillText(
                                "CORES",
                                xPadding + 20 + colWidth * 2,
                                startY,
                            );
                            ctx.fillStyle = "#171717";
                            ctx.font = "bold 16px monospace";
                            ctx.fillText(
                                colorsVal,
                                xPadding + 20 + colWidth * 2,
                                startY + 25,
                            );
                        }

                        const size1 =
                            document.getElementById("printSize").value || "---";
                        const colors1 =
                            document.getElementById("numColors").value || "---";
                        const qty =
                            document.getElementById("quantity").value || "---";

                        ctx.fillStyle = "#171717";
                        ctx.font = "bold 16px monospace";
                        ctx.fillText("POSI√á√ÉO 1", xPadding + 20, specsY + 60);
                        drawSpecsRow(specsY + 60, "", size1, colors1);

                        ctx.fillStyle = "#737373";
                        ctx.font = "12px monospace";
                        ctx.fillText(
                            "QUANTIDADES",
                            xPadding + 20,
                            specsY + 110,
                        );
                        ctx.fillStyle = "#171717";
                        ctx.font = "bold 16px monospace";
                        ctx.fillText(qty, xPadding + 20, specsY + 135);

                        if (hasPos2) {
                            const size2 =
                                document.getElementById("printSize_2").value ||
                                "---";
                            const colors2 =
                                document.getElementById("numColors_2").value ||
                                "---";

                            const row2Y = specsY + 160;
                            ctx.fillStyle = "#e5e5e5";
                            ctx.fillRect(
                                xPadding + 10,
                                row2Y - 20,
                                cardWidth - 20,
                                1,
                            );

                            ctx.fillStyle = "#171717";
                            ctx.font = "bold 16px monospace";
                            ctx.fillText(
                                "POSI√á√ÉO 2",
                                xPadding + 20,
                                row2Y + 10,
                            );

                            drawSpecsRow(row2Y + 10, "", size2, colors2);
                        }

                        // Footer
                        ctx.fillStyle = "#a3a3a3";
                        ctx.font = "12px monospace";
                        ctx.fillText(
                            "IMACX.PT",
                            xPadding,
                            exportCanvas.height - 40,
                        );

                        // Main area
                        const mainX = sidebarWidth;
                        const mainWidth = exportCanvas.width - sidebarWidth;

                        ctx.beginPath();
                        ctx.moveTo(mainX + 40, 100);
                        ctx.lineTo(exportCanvas.width - 40, 100);
                        ctx.strokeStyle = "#f5f5f5";
                        ctx.stroke();

                        ctx.fillStyle = "#22c55e";
                        ctx.beginPath();
                        ctx.arc(mainX + 50, 80, 4, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = "#a3a3a3";
                        ctx.font = "12px monospace";
                        ctx.fillText("MOCKUP PREVIEW", mainX + 65, 84);

                        const dateText = document
                            .getElementById("presCurrentDate")
                            .textContent.trim();
                        ctx.textAlign = "right";
                        ctx.fillText(dateText, exportCanvas.width - 50, 84);
                        ctx.textAlign = "left";

                        const imgAreaX = mainX + 50;
                        const imgAreaY = 140;
                        const imgAreaW = mainWidth - 100;
                        const imgAreaH = exportCanvas.height - 300;

                        // Removed background card and border as per user request
                        // ctx.fillStyle = "#fafafa";
                        // ctx.fillRect(imgAreaX, imgAreaY, imgAreaW, imgAreaH);
                        // ctx.strokeStyle = "#e5e5e5";
                        // ctx.setLineDash([5, 5]);
                        // ctx.strokeRect(imgAreaX, imgAreaY, imgAreaW, imgAreaH);
                        // ctx.setLineDash([]);

                        // Draw the mockup image - recreate from base64 to avoid CORS
                        // Helper to render mockup
                        async function renderMockupToCanvas(
                            targetCtx,
                            x,
                            y,
                            w,
                            h,
                            pImg,
                            lBase64,
                            lScale,
                            lRot,
                            lX,
                            lY,
                            lPersp,
                            lCorners,
                        ) {
                            if (!pImg || !lBase64) return;

                            const tempCanvas = document.createElement("canvas");
                            // Use canvas size to match screen composition
                            const mainCanvas =
                                document.getElementById("mockupCanvas");
                            tempCanvas.width = mainCanvas.width;
                            tempCanvas.height = mainCanvas.height;
                            const tCtx = tempCanvas.getContext("2d");

                            // Draw product
                            const pImage = new Image();
                            pImage.src = pImg.src;
                            await new Promise((r) => (pImage.onload = r));

                            const scale = Math.min(
                                tempCanvas.width / pImage.width,
                                tempCanvas.height / pImage.height,
                            );
                            const pw = pImage.width * scale;
                            const ph = pImage.height * scale;
                            const px = (tempCanvas.width - pw) / 2;
                            const py = (tempCanvas.height - ph) / 2;
                            tCtx.drawImage(pImage, px, py, pw, ph);

                            // Draw logo
                            const lImage = new Image();
                            lImage.src = lBase64;
                            await new Promise((r) => (lImage.onload = r));

                            if (!lPersp) {
                                tCtx.save();
                                tCtx.translate(lX, lY);
                                tCtx.rotate(lRot);
                                tCtx.drawImage(
                                    lImage,
                                    -(lImage.width * lScale) / 2,
                                    -(lImage.height * lScale) / 2,
                                    lImage.width * lScale,
                                    lImage.height * lScale,
                                );
                                tCtx.restore();
                            } else if (lCorners) {
                                const centerX =
                                    (lCorners.topLeft.x +
                                        lCorners.topRight.x +
                                        lCorners.bottomLeft.x +
                                        lCorners.bottomRight.x) /
                                    4;
                                const centerY =
                                    (lCorners.topLeft.y +
                                        lCorners.topRight.y +
                                        lCorners.bottomLeft.y +
                                        lCorners.bottomRight.y) /
                                    4;

                                const topWidth = Math.sqrt(
                                    Math.pow(
                                        lCorners.topRight.x -
                                            lCorners.topLeft.x,
                                        2,
                                    ) +
                                        Math.pow(
                                            lCorners.topRight.y -
                                                lCorners.topLeft.y,
                                            2,
                                        ),
                                );
                                const bottomWidth = Math.sqrt(
                                    Math.pow(
                                        lCorners.bottomRight.x -
                                            lCorners.bottomLeft.x,
                                        2,
                                    ) +
                                        Math.pow(
                                            lCorners.bottomRight.y -
                                                lCorners.bottomLeft.y,
                                            2,
                                        ),
                                );
                                const leftHeight = Math.sqrt(
                                    Math.pow(
                                        lCorners.bottomLeft.x -
                                            lCorners.topLeft.x,
                                        2,
                                    ) +
                                        Math.pow(
                                            lCorners.bottomLeft.y -
                                                lCorners.topLeft.y,
                                            2,
                                        ),
                                );
                                const rightHeight = Math.sqrt(
                                    Math.pow(
                                        lCorners.bottomRight.x -
                                            lCorners.topRight.x,
                                        2,
                                    ) +
                                        Math.pow(
                                            lCorners.bottomRight.y -
                                                lCorners.topRight.y,
                                            2,
                                        ),
                                );

                                const avgWidth = (topWidth + bottomWidth) / 2;
                                const avgHeight =
                                    (leftHeight + rightHeight) / 2;
                                const angle = Math.atan2(
                                    lCorners.topRight.y - lCorners.topLeft.y,
                                    lCorners.topRight.x - lCorners.topLeft.x,
                                );

                                const skewX =
                                    (lCorners.bottomRight.x -
                                        lCorners.bottomLeft.x -
                                        (lCorners.topRight.x -
                                            lCorners.topLeft.x)) /
                                    avgHeight;
                                const skewY =
                                    (lCorners.bottomRight.y -
                                        lCorners.topRight.y -
                                        (lCorners.bottomLeft.y -
                                            lCorners.topLeft.y)) /
                                    avgWidth;

                                tCtx.save();
                                tCtx.translate(centerX, centerY);
                                tCtx.rotate(angle);
                                tCtx.transform(1, skewY, skewX, 1, 0, 0);
                                tCtx.drawImage(
                                    lImage,
                                    -avgWidth / 2,
                                    -avgHeight / 2,
                                    avgWidth,
                                    avgHeight,
                                );
                                tCtx.restore();
                            }

                            // Draw to target
                            const drawScale = Math.min(
                                w / tempCanvas.width,
                                h / tempCanvas.height,
                            );
                            const dw = tempCanvas.width * drawScale;
                            const dh = tempCanvas.height * drawScale;
                            const dx = x + (w - dw) / 2;
                            const dy = y + (h - dh) / 2;

                            // Removed shadow from product images as per user request
                            // targetCtx.shadowColor = "rgba(0, 0, 0, 0.2)";
                            // targetCtx.shadowBlur = 20;
                            // targetCtx.shadowOffsetY = 10;
                            targetCtx.drawImage(tempCanvas, dx, dy, dw, dh);
                            // targetCtx.shadowColor = "transparent";
                        }

                        if (hasPos2) {
                            const gap = 20;
                            const singleW = (imgAreaW - gap) / 2;

                            // Draw Pos 1
                            await renderMockupToCanvas(
                                ctx,
                                imgAreaX,
                                imgAreaY,
                                singleW,
                                imgAreaH,
                                productImg,
                                logoBase64,
                                logoScale,
                                logoRotation,
                                logoX,
                                logoY,
                                perspectiveMode,
                                logoCorners,
                            );

                            // Draw Pos 2
                            const p2 = productImg_2 || productImg;
                            await renderMockupToCanvas(
                                ctx,
                                imgAreaX + singleW + gap,
                                imgAreaY,
                                singleW,
                                imgAreaH,
                                p2,
                                logoBase64_2,
                                logoScale_2,
                                logoRotation_2,
                                logoX_2,
                                logoY_2,
                                perspectiveMode_2,
                                logoCorners_2,
                            );
                        } else {
                            // Draw Single
                            await renderMockupToCanvas(
                                ctx,
                                imgAreaX,
                                imgAreaY,
                                imgAreaW,
                                imgAreaH,
                                productImg,
                                logoBase64,
                                logoScale,
                                logoRotation,
                                logoX,
                                logoY,
                                perspectiveMode,
                                logoCorners,
                            );
                        }

                        const disclaimerY = exportCanvas.height - 100;
                        ctx.beginPath();
                        ctx.moveTo(mainX + 40, disclaimerY - 20);
                        ctx.lineTo(exportCanvas.width - 40, disclaimerY - 20);
                        ctx.strokeStyle = "#e5e5e5";
                        ctx.stroke();

                        ctx.fillStyle = "#ea580c";
                        ctx.font = "bold 12px sans-serif";
                        ctx.fillText(
                            "NOTA IMPORTANTE:",
                            mainX + 50,
                            disclaimerY + 10,
                        );

                        ctx.fillStyle = "#525252";
                        ctx.font = "12px sans-serif";
                        const disclaimerText =
                            "A fim de garantir a qualidade e exatid√£o do trabalho, √© favor confirmar a maqueta enviada: pantone, dimens√µes da imagem e posicionamento da mesma. √â da responsabilidade do cliente verificar a totalidade do documento enviado e posteriormente aprovar. A aprova√ß√£o da maqueta vincula a produ√ß√£o.";
                        wrapText(
                            ctx,
                            disclaimerText,
                            mainX + 180,
                            disclaimerY + 10,
                            imgAreaW - 150,
                            18,
                        );

                        // Download
                        const link = document.createElement("a");
                        link.download = "presentation-export.jpg";
                        link.href = exportCanvas.toDataURL("image/jpeg", 0.9);
                        link.click();

                        // Restore buttons
                        exportPresentationBtn.style.display = "";
                        closeBtn.style.display = "";
                        exportPresentationBtn.innerHTML = originalText;
                        exportPresentationBtn.disabled = false;
                    } catch (error) {
                        console.error("Export error:", error);
                        alert("Error exporting image: " + error.message);
                        const exportPresentationBtn = document.getElementById(
                            "exportPresentationBtn",
                        );
                        const closeBtn =
                            document.getElementById("closePresentation");
                        exportPresentationBtn.style.display = "";
                        closeBtn.style.display = "";
                        exportPresentationBtn.disabled = false;
                        exportPresentationBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></svg> Export JPG (150dpi)`;
                    }
                });
            }

            // Mode toggle handlers
            function setActiveMode(mode) {
                const btn2D = activeTab === 1 ? mode2DBtn : mode2DBtn_2;
                const btnPersp =
                    activeTab === 1 ? modePerspectiveBtn : modePerspectiveBtn_2;

                [btn2D, btnPersp].forEach((btn) => {
                    btn.classList.remove(
                        "bg-orange-500",
                        "text-white",
                        "border-orange-500",
                    );
                    btn.classList.add(
                        "border-neutral-300",
                        "dark:border-neutral-700",
                        "text-neutral-600",
                        "dark:text-neutral-400",
                    );
                });

                if (mode === "2D") {
                    btn2D.classList.add(
                        "bg-orange-500",
                        "text-white",
                        "border-orange-500",
                    );
                    btn2D.classList.remove(
                        "border-neutral-300",
                        "dark:border-neutral-700",
                        "text-neutral-600",
                        "dark:text-neutral-400",
                    );
                } else if (mode === "PERSPECTIVE") {
                    btnPersp.classList.add(
                        "bg-orange-500",
                        "text-white",
                        "border-orange-500",
                    );
                    btnPersp.classList.remove(
                        "border-neutral-300",
                        "dark:border-neutral-700",
                        "text-neutral-600",
                        "dark:text-neutral-400",
                    );
                }
            }

            function updateLockState(checkbox, locked, descEl) {
                checkbox.checked = locked;
                if (locked) {
                    descEl.textContent =
                        "Perspetiva bloqueada - Use os sliders para ajustar tamanho/rota√ß√£o";
                } else {
                    descEl.textContent =
                        "Arraste os cantos para ajustar a perspectiva manualmente";
                }
            }

            mode2DBtn.addEventListener("click", () => {
                perspectiveMode = false;
                perspectiveLocked = false;
                logoCorners = null;
                setActiveMode("2D");
                // Hide all perspective controls
                if (perspectiveControls)
                    perspectiveControls.style.display = "none";
                draw();
            });

            modePerspectiveBtn.addEventListener("click", () => {
                perspectiveMode = true;
                perspectiveLocked = false;
                if (logoImg && !logoCorners) initializeLogoCorners();
                setActiveMode("PERSPECTIVE");

                // Show perspective controls
                if (perspectiveControls) {
                    perspectiveControls.style.display = "block";
                    updateLockState(lockPerspectiveCheckbox, false, modeDesc);
                }
                draw();
            });

            if (lockPerspectiveCheckbox) {
                lockPerspectiveCheckbox.addEventListener("change", (e) => {
                    if (!logoCorners) {
                        e.target.checked = false; // Prevent checking if no corners
                        return;
                    }
                    perspectiveLocked = e.target.checked;
                    updateLockState(
                        lockPerspectiveCheckbox,
                        perspectiveLocked,
                        modeDesc,
                    );
                    draw();
                });
            }

            mode2DBtn_2.addEventListener("click", () => {
                perspectiveMode_2 = false;
                perspectiveLocked_2 = false;
                logoCorners_2 = null;
                setActiveMode("2D");
                // Hide all perspective controls
                if (perspectiveControls_2)
                    perspectiveControls_2.style.display = "none";
                draw();
            });

            modePerspectiveBtn_2.addEventListener("click", () => {
                perspectiveMode_2 = true;
                perspectiveLocked_2 = false;

                // -----------------------------------------------------------------
                // Initialise the corner data for the second logo (if it exists).
                // `initializeLogoCorners()` works off the global `activeTab`,
                // so we temporarily set it to 2, call the function, then restore
                // the previous tab value.
                // -----------------------------------------------------------------
                const previousTab = activeTab; // remember current tab
                activeTab = 2; // tell the helper we are on tab 2
                if (logoImg2 && !logoCorners_2) {
                    // This will compute the four corner points based on the logo
                    // size, scale and position (logoX_2 / logoY_2).
                    initializeLogoCorners();
                }
                activeTab = previousTab; // restore the original tab

                setActiveMode("PERSPECTIVE");

                // Show perspective controls
                if (perspectiveControls_2) {
                    perspectiveControls_2.style.display = "block";
                    updateLockState(
                        lockPerspectiveCheckbox_2,
                        false,
                        modeDesc_2,
                    );
                }
                draw();
            });

            if (lockPerspectiveCheckbox_2) {
                lockPerspectiveCheckbox_2.addEventListener("change", (e) => {
                    if (!logoCorners_2) {
                        e.target.checked = false;
                        return;
                    }
                    perspectiveLocked_2 = e.target.checked;
                    updateLockState(
                        lockPerspectiveCheckbox_2,
                        perspectiveLocked_2,
                        modeDesc_2,
                    );
                    draw();
                });
            }

            function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
                const words = text.split(" ");
                let line = "";
                let currentY = y;

                for (let n = 0; n < words.length; n++) {
                    const testLine = line + words[n] + " ";
                    const metrics = ctx.measureText(testLine);
                    const testWidth = metrics.width;
                    if (testWidth > maxWidth && n > 0) {
                        ctx.fillText(line, x, currentY);
                        line = words[n] + " ";
                        currentY += lineHeight;
                    } else {
                        line = testLine;
                    }
                }
                ctx.fillText(line, x, currentY);
                return currentY; // Return the final Y position
            }

            // Presentation Mode Logic
            const presentationBtn = document.getElementById("presentationBtn");
            const presentationOverlay = document.getElementById(
                "presentationOverlay",
            );
            const closePresentation =
                document.getElementById("closePresentation");

            presentationBtn.addEventListener("click", async () => {
                // Gather Data
                const clientName =
                    document.getElementById("clientName").value ||
                    "Cliente n√£o especificado";
                const refNumber =
                    document.getElementById("refNumber").value || "---";
                const productTitle =
                    document.getElementById("productTitle").value ||
                    "Sem T√≠tulo";
                const productDescription =
                    document.getElementById("productDescription").value ||
                    "Sem descri√ß√£o.";
                const quantity =
                    document.getElementById("quantity").value || "---";
                const deliveryDate =
                    document.getElementById("deliveryDate").value || "---";
                const printSize =
                    document.getElementById("printSize").value || "---";
                const numColors =
                    document.getElementById("numColors").value || "---";

                // Update Overlay DOM
                document.getElementById("presClient").textContent = clientName;
                document.getElementById("presRef").textContent =
                    `REF: ${refNumber}`;
                document.getElementById("presTitle").textContent = productTitle;

                // Format description
                const formattedDesc = productDescription
                    .replace(/\n/g, "<br>")
                    .replace(/\*\*(.*?)\*\*/g, "<b>$1</b>");
                document.getElementById("presDesc").innerHTML = formattedDesc;

                document.getElementById("presQty").textContent = quantity;
                document.getElementById("presSize").textContent = printSize;
                document.getElementById("presColors").textContent = numColors;
                document.getElementById("presCurrentDate").textContent =
                    deliveryDate !== "---"
                        ? deliveryDate
                        : new Date().toLocaleDateString();

                // Handle Position 2 Specs
                const hasPos2 = !!logoImg2;
                const specsContainer = document.querySelector(
                    "#presentationOverlay .grid",
                );

                // Clean up any existing Pos 2 specs
                const existingPos2Specs =
                    specsContainer.querySelectorAll(".pos2-spec");
                existingPos2Specs.forEach((el) => el.remove());

                if (hasPos2) {
                    const printSize2 =
                        document.getElementById("printSize_2").value || "---";
                    const numColors2 =
                        document.getElementById("numColors_2").value || "---";

                    // Add separator
                    const separator = document.createElement("div");
                    separator.className =
                        "col-span-3 h-px bg-neutral-200 my-2 pos2-spec";
                    specsContainer.appendChild(separator);

                    // Add Pos 2 Header
                    const pos2Header = document.createElement("div");
                    pos2Header.className = "pos2-spec";
                    pos2Header.innerHTML = `
                    <h3 class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 mb-1">POSI√á√ÉO 2</h3>
                    <p class="font-mono text-sm font-bold text-neutral-900">B</p>
                `;
                    specsContainer.appendChild(pos2Header);

                    // Add Pos 2 Size
                    const pos2Size = document.createElement("div");
                    pos2Size.className = "pos2-spec";
                    pos2Size.innerHTML = `
                    <h3 class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 mb-1">DIMENS√ÉO IMPRESS√ÉO</h3>
                    <p class="font-mono text-sm font-bold text-neutral-900">${printSize2}</p>
                `;
                    specsContainer.appendChild(pos2Size);

                    // Add Pos 2 Colors
                    const pos2Colors = document.createElement("div");
                    pos2Colors.className = "pos2-spec";
                    pos2Colors.innerHTML = `
                    <h3 class="text-xs font-mono uppercase tracking-wider text-neutral-500 dark:text-neutral-500 mb-1">N¬∫ CORES</h3>
                    <p class="font-mono text-sm font-bold text-neutral-900">${numColors2}</p>
                `;
                    specsContainer.appendChild(pos2Colors);
                }

                // Generate Image(s)
                const presImage = document.getElementById("presImage");

                if (hasPos2) {
                    // Create a temporary canvas to combine both images
                    const tempCanvas = document.createElement("canvas");
                    tempCanvas.width = 1200; // Double width
                    tempCanvas.height = 600;
                    const tCtx = tempCanvas.getContext("2d");

                    // Render Pos 1
                    await renderMockupToCanvas(
                        tCtx,
                        0,
                        0,
                        600,
                        600,
                        productImg,
                        logoBase64,
                        logoScale,
                        logoRotation,
                        logoX,
                        logoY,
                        perspectiveMode,
                        logoCorners,
                    );

                    // Render Pos 2
                    await renderMockupToCanvas(
                        tCtx,
                        600,
                        0,
                        600,
                        600,
                        productImg_2,
                        logoBase64_2,
                        logoScale_2,
                        logoRotation_2,
                        logoX_2,
                        logoY_2,
                        perspectiveMode_2,
                        logoCorners_2,
                    );

                    presImage.src = tempCanvas.toDataURL("image/png");
                } else {
                    // Single image render
                    draw(true); // Hide handles
                    presImage.src = canvas.toDataURL("image/png");
                    draw(false); // Show handles
                }

                // Show Overlay
                presentationOverlay.classList.remove("hidden");
            });

            closePresentation.addEventListener("click", () => {
                presentationOverlay.classList.add("hidden");
            });

            // Close on Escape key
            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape") {
                    // Close background removal modal if open
                    if (!bgRemovalModal.classList.contains("hidden")) {
                        bgRemovalModal.classList.add("hidden");
                    }
                    // Close presentation overlay if open
                    else if (
                        !presentationOverlay.classList.contains("hidden")
                    ) {
                        presentationOverlay.classList.add("hidden");
                    }
                }
            });
        </script>
    </body>
</html>
